define("vendor/backbone",[],function(){var a={};return a._=window._,a.jQuery=window.jQuery,function(){var a=this,b=a.Backbone,c=Array.prototype.slice,d=Array.prototype.splice,e;typeof exports!="undefined"?e=exports:e=a.Backbone={},e.VERSION="0.9.2";var f=a._,g=a.jQuery||a.Zepto||a.ender;e.setDomLibrary=function(a){g=a},e.noConflict=function(){return a.Backbone=b,this},e.emulateHTTP=!1,e.emulateJSON=!1;var h=/\s+/,i=e.Events={on:function(a,b,c){var d,e,f,g,i;if(!b)return this;a=a.split(h),d=this._callbacks||(this._callbacks={});while(e=a.shift())i=d[e],f=i?i.tail:{},f.next=g={},f.context=c,f.callback=b,d[e]={tail:g,next:i?i.next:f};return this},off:function(a,b,c){var d,e,g,i,j,k;if(!(e=this._callbacks))return;if(!(a||b||c))return delete this._callbacks,this;a=a?a.split(h):f.keys(e);while(d=a.shift()){g=e[d],delete e[d];if(!g||!b&&!c)continue;i=g.tail;while((g=g.next)!==i)j=g.callback,k=g.context,(b&&j!==b||c&&k!==c)&&this.on(d,j,k)}return this},trigger:function(a){var b,d,e,f,g,i,j;if(!(e=this._callbacks))return this;i=e.all,a=a.split(h),j=c.call(arguments,1);while(b=a.shift()){if(d=e[b]){f=d.tail;while((d=d.next)!==f)d.callback.apply(d.context||this,j)}if(d=i){f=d.tail,g=[b].concat(j);while((d=d.next)!==f)d.callback.apply(d.context||this,g)}}return this}};i.bind=i.on,i.unbind=i.off;var j=e.Model=function(a,b){var c;a||(a={}),b&&b.parse&&(a=this.parse(a));if(c=A(this,"defaults"))a=f.extend({},c,a);b&&b.collection&&(this.collection=b.collection),this.attributes={},this._escapedAttributes={},this.cid=f.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(a,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=f.clone(this.attributes),this.initialize.apply(this,arguments)};f.extend(j.prototype,i,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(a){return f.clone(this.attributes)},get:function(a){return this.attributes[a]},escape:function(a){var b;if(b=this._escapedAttributes[a])return b;var c=this.get(a);return this._escapedAttributes[a]=f.escape(c==null?"":""+c)},has:function(a){return this.get(a)!=null},set:function(a,b,c){var d,e,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c||(c={});if(!d)return this;d instanceof j&&(d=d.attributes);if(c.unset)for(e in d)d[e]=void 0;if(!this._validate(d,c))return!1;this.idAttribute in d&&(this.id=d[this.idAttribute]);var h=c.changes={},i=this.attributes,k=this._escapedAttributes,l=this._previousAttributes||{};for(e in d){g=d[e];if(!f.isEqual(i[e],g)||c.unset&&f.has(i,e))delete k[e],(c.silent?this._silent:h)[e]=!0;c.unset?delete i[e]:i[e]=g,!f.isEqual(l[e],g)||f.has(i,e)!=f.has(l,e)?(this.changed[e]=g,c.silent||(this._pending[e]=!0)):(delete this.changed[e],delete this._pending[e])}return c.silent||this.change(c),this},unset:function(a,b){return(b||(b={})).unset=!0,this.set(a,null,b)},clear:function(a){return(a||(a={})).unset=!0,this.set(f.clone(this.attributes),a)},fetch:function(a){a=a?f.clone(a):{};var b=this,c=a.success;return a.success=function(d,e,f){if(!b.set(b.parse(d,f),a))return!1;c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},save:function(a,b,c){var d,g;f.isObject(a)||a==null?(d=a,c=b):(d={},d[a]=b),c=c?f.clone(c):{};if(c.wait){if(!this._validate(d,c))return!1;g=f.clone(this.attributes)}var h=f.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?h:c))return!1;var i=this,j=c.success;c.success=function(a,b,e){var g=i.parse(a,e);c.wait&&(delete c.wait,g=f.extend(d||{},g));if(!i.set(g,c))return!1;j?j(i,a):i.trigger("sync",i,a,c)},c.error=e.wrapError(c.error,i,c);var k=this.isNew()?"create":"update",l=(this.sync||e.sync).call(this,k,this,c);return c.wait&&this.set(g,h),l},destroy:function(a){a=a?f.clone(a):{};var b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};if(this.isNew())return d(),!1;a.success=function(e){a.wait&&d(),c?c(b,e):b.trigger("sync",b,e,a)},a.error=e.wrapError(a.error,b,a);var g=(this.sync||e.sync).call(this,"delete",this,a);return a.wait||d(),g},url:function(){var a=A(this,"urlRoot")||A(this.collection,"url")||B();return this.isNew()?a:a+(a.charAt(a.length-1)=="/"?"":"/")+encodeURIComponent(this.id)},parse:function(a,b){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return this.id==null},change:function(a){a||(a={});var b=this._changing;this._changing=!0;for(var c in this._silent)this._pending[c]=!0;var d=f.extend({},a.changes,this._silent);this._silent={};for(var c in d)this.trigger("change:"+c,this,this.get(c),a);if(b)return this;while(!f.isEmpty(this._pending)){this._pending={},this.trigger("change",this,a);for(var c in this.changed){if(this._pending[c]||this._silent[c])continue;delete this.changed[c]}this._previousAttributes=f.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(a){return arguments.length?f.has(this.changed,a):!f.isEmpty(this.changed)},changedAttributes:function(a){if(!a)return this.hasChanged()?f.clone(this.changed):!1;var b,c=!1,d=this._previousAttributes;for(var e in a){if(f.isEqual(d[e],b=a[e]))continue;(c||(c={}))[e]=b}return c},previous:function(a){return!arguments.length||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return f.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(a,b){if(b.silent||!this.validate)return!0;a=f.extend({},this.attributes,a);var c=this.validate(a,b);return c?(b&&b.error?b.error(this,c,b):this.trigger("error",this,c,b),!1):!0}});var k=e.Collection=function(a,b){b||(b={}),b.model&&(this.model=b.model),b.comparator&&(this.comparator=b.comparator),this._reset(),this.initialize.apply(this,arguments),a&&this.reset(a,{silent:!0,parse:b.parse})};f.extend(k.prototype,i,{model:j,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},add:function(a,b){var c,e,g,h,i,j,k={},l={},m=[];b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,g=a.length;c<g;c++){if(!(h=a[c]=this._prepareModel(a[c],b)))throw new Error("Can't add an invalid model to a collection");i=h.cid,j=h.id;if(k[i]||this._byCid[i]||j!=null&&(l[j]||this._byId[j])){m.push(c);continue}k[i]=l[j]=h}c=m.length;while(c--)a.splice(m[c],1);for(c=0,g=a.length;c<g;c++)(h=a[c]).on("all",this._onModelEvent,this),this._byCid[h.cid]=h,h.id!=null&&(this._byId[h.id]=h);this.length+=g,e=b.at!=null?b.at:this.models.length,d.apply(this.models,[e,0].concat(a)),this.comparator&&this.sort({silent:!0});if(b.silent)return this;for(c=0,g=this.models.length;c<g;c++){if(!k[(h=this.models[c]).cid])continue;b.index=c,h.trigger("add",h,this,b)}return this},remove:function(a,b){var c,d,e,g;b||(b={}),a=f.isArray(a)?a.slice():[a];for(c=0,d=a.length;c<d;c++){g=this.getByCid(a[c])||this.get(a[c]);if(!g)continue;delete this._byId[g.id],delete this._byCid[g.cid],e=this.indexOf(g),this.models.splice(e,1),this.length--,b.silent||(b.index=e,g.trigger("remove",g,this,b)),this._removeReference(g)}return this},push:function(a,b){return a=this._prepareModel(a,b),this.add(a,b),a},pop:function(a){var b=this.at(this.length-1);return this.remove(b,a),b},unshift:function(a,b){return a=this._prepareModel(a,b),this.add(a,f.extend({at:0},b)),a},shift:function(a){var b=this.at(0);return this.remove(b,a),b},get:function(a){return a==null?void 0:this._byId[a.id!=null?a.id:a]},getByCid:function(a){return a&&this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return f.isEmpty(a)?[]:this.filter(function(b){for(var c in a)if(a[c]!==b.get(c))return!1;return!0})},sort:function(a){a||(a={});if(!this.comparator)throw new Error("Cannot sort a set without a comparator");var b=f.bind(this.comparator,this);return this.comparator.length==1?this.models=this.sortBy(b):this.models.sort(b),a.silent||this.trigger("reset",this,a),this},pluck:function(a){return f.map(this.models,function(b){return b.get(a)})},reset:function(a,b){a||(a=[]),b||(b={});var c=this.models;for(var d=0,e=this.models.length;d<e;d++)this._removeReference(this.models[d]);return this._reset(),this.add(a,f.extend({silent:!0},b)),b.silent||this.trigger("reset",this,b,c),this},fetch:function(a){a=a?f.clone(a):{},a.parse===undefined&&(a.parse=!0);var b=this,c=a.success;return a.success=function(d,e,f){b[a.add?"add":"reset"](b.parse(d,f),a),c&&c(b,d)},a.error=e.wrapError(a.error,b,a),(this.sync||e.sync).call(this,"read",this,a)},create:function(a,b){var c=this;b=b?f.clone(b):{},a=this._prepareModel(a,b);if(!a)return!1;b.wait||c.add(a,b);var d=b.success;return b.success=function(e,f,g){b.wait&&c.add(e,b),d?d(e,f):e.trigger("sync",a,f,b)},a.save(null,b),a},parse:function(a,b){return a},chain:function(){return f(this.models).chain()},_reset:function(a){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(a,b){b||(b={});if(a instanceof j)a.collection||(a.collection=this);else{var c=a;b.collection=this,a=new this.model(c,b),a._validate(a.attributes,b)||(a=!1)}return a},_removeReference:function(a){this==a.collection&&delete a.collection,a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){if((a=="add"||a=="remove")&&c!=this)return;a=="destroy"&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],this._byId[b.id]=b),this.trigger.apply(this,arguments)}});var l=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];f.each(l,function(a){k.prototype[a]=function(){return f[a].apply(f,[this.models].concat(f.toArray(arguments)))}});var m=e.Router=function(a){a||(a={}),a.routes&&(this.routes=a.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},n=/:\w+/g,o=/\*\w+/g,p=/[-[\]{}()+?.,\\^$|#\s]/g;f.extend(m.prototype,i,{initialize:function(){},route:function(a,b,c){return e.history||(e.history=new q),f.isRegExp(a)||(a=this._routeToRegExp(a)),c||(c=this[b]),e.history.route(a,f.bind(function(d){var f=this._extractParameters(a,d);c&&c.apply(this,f),this.trigger.apply(this,["route:"+b].concat(f)),e.history.trigger("route",this,b,f)},this)),this},navigate:function(a,b){e.history.navigate(a,b)},_bindRoutes:function(){if(!this.routes)return;var a=[];for(var b in this.routes)a.unshift([b,this.routes[b]]);for(var c=0,d=a.length;c<d;c++)this.route(a[c][0],a[c][1],this[a[c][1]])},_routeToRegExp:function(a){return a=a.replace(p,"\\$&").replace(n,"([^/]+)").replace(o,"(.*?)"),new RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var q=e.History=function(){this.handlers=[],f.bindAll(this,"checkUrl")},r=/^[#\/]/,s=/msie [\w.]+/;q.started=!1,f.extend(q.prototype,i,{interval:50,getHash:function(a){var b=a?a.location:window.location,c=b.href.match(/#(.*)$/);return c?c[1]:""},getFragment:function(a,b){if(a==null)if(this._hasPushState||b){a=window.location.pathname;var c=window.location.search;c&&(a+=c)}else a=this.getHash();return a.indexOf(this.options.root)||(a=a.substr(this.options.root.length)),a.replace(r,"")},start:function(a){if(q.started)throw new Error("Backbone.history has already been started");q.started=!0,this.options=f.extend({},{root:"/"},this.options,a),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var b=this.getFragment(),c=document.documentMode,d=s.exec(navigator.userAgent.toLowerCase())&&(!c||c<=7);d&&(this.iframe=g('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(b)),this._hasPushState?g(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!d?g(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=b;var e=window.location,h=e.pathname==this.options.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!h)return this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0;this._wantsPushState&&this._hasPushState&&h&&e.hash&&(this.fragment=this.getHash().replace(r,""),window.history.replaceState({},document.title,e.protocol+"//"+e.host+this.options.root+this.fragment));if(!this.options.silent)return this.loadUrl()},stop:function(){g(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),q.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(a){var b=this.getFragment();b==this.fragment&&this.iframe&&(b=this.getFragment(this.getHash(this.iframe)));if(b==this.fragment)return!1;this.iframe&&this.navigate(b),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a),c=f.any(this.handlers,function(a){if(a.route.test(b))return a.callback(b),!0});return c},navigate:function(a,b){if(!q.started)return!1;if(!b||b===!0)b={trigger:b};var c=(a||"").replace(r,"");if(this.fragment==c)return;this._hasPushState?(c.indexOf(this.options.root)!=0&&(c=this.options.root+c),this.fragment=c,window.history[b.replace?"replaceState":"pushState"]({},document.title,c)):this._wantsHashChange?(this.fragment=c,this._updateHash(window.location,c,b.replace),this.iframe&&c!=this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,c,b.replace))):window.location.assign(this.options.root+a),b.trigger&&this.loadUrl(a)},_updateHash:function(a,b,c){c?a.replace(a.toString().replace(/(javascript:|#).*$/,"")+"#"+b):a.hash=b}});var t=e.View=function(a){this.cid=f.uniqueId("view"),this._configure(a||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},u=/^(\S+)\s*(.*)$/,v=["model","collection","el","id","attributes","className","tagName"];f.extend(t.prototype,i,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(a,b,c){var d=document.createElement(a);return b&&g(d).attr(b),c&&g(d).html(c),d},setElement:function(a,b){return this.$el&&this.undelegateEvents(),this.$el=a instanceof g?a:g(a),this.el=this.$el[0],b!==!1&&this.delegateEvents(),this},delegateEvents:function(a){if(!a&&!(a=A(this,"events")))return;this.undelegateEvents();for(var b in a){var c=a[b];f.isFunction(c)||(c=this[a[b]]);if(!c)throw new Error('Method "'+a[b]+'" does not exist');var d=b.match(u),e=d[1],g=d[2];c=f.bind(c,this),e+=".delegateEvents"+this.cid,g===""?this.$el.bind(e,c):this.$el.delegate(g,e,c)}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=f.extend({},this.options,a));for(var b=0,c=v.length;b<c;b++){var d=v[b];a[d]&&(this[d]=a[d])}this.options=a},_ensureElement:function(){if(!this.el){var a=A(this,"attributes")||{};this.id&&(a.id=this.id),this.className&&(a["class"]=this.className),this.setElement(this.make(this.tagName,a),!1)}else this.setElement(this.el,!1)}});var w=function(a,b){var c=z(this,a,b);return c.extend=this.extend,c};j.extend=k.extend=m.extend=t.extend=w;var x={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(a,b,c){var d=x[a];c||(c={});var h={type:d,dataType:"json"};return c.url||(h.url=A(b,"url")||B()),!c.data&&b&&(a=="create"||a=="update")&&(h.contentType="application/json",h.data=JSON.stringify(b.toJSON())),e.emulateJSON&&(h.contentType="application/x-www-form-urlencoded",h.data=h.data?{model:h.data}:{}),e.emulateHTTP&&(d==="PUT"||d==="DELETE")&&(e.emulateJSON&&(h.data._method=d),h.type="POST",h.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d)}),h.type!=="GET"&&!e.emulateJSON&&(h.processData=!1),g.ajax(f.extend(h,c))},e.wrapError=function(a,b,c){return function(d,e){e=d===b?e:d,a?a(b,e,c):b.trigger("error",b,e,c)}};var y=function(){},z=function(a,b,c){var d;return b&&b.hasOwnProperty("constructor")?d=b.constructor:d=function(){a.apply(this,arguments)},f.extend(d,a),y.prototype=a.prototype,d.prototype=new y,b&&f.extend(d.prototype,b),c&&f.extend(d,c),d.prototype.constructor=d,d.__super__=a.prototype,d},A=function(a,b){return!a||!a[b]?null:f.isFunction(a[b])?a[b]():a[b]},B=function(){throw new Error('A "url" property or function must be specified')}}.call(a),a.Backbone}),define("common/MapResolver",{resolveItem:function(a,b){var c=typeof b;if(c==="string"||c==="number")return a[b];var d=a;for(var e=0;e<b.length;++e){var f=b[e];d=d[f];if(!d)return null}return d},placeItem:function(a,b,c){var d=typeof b;if(d==="string"||d==="number")return a[b]=c;var e=a;for(var f=0;f<b.length-1;++f){var g=b[f],h=e[g];h||(h={},e[g]=h),e=h}var i=b[b.length-1];return e[i]=c}}),define("state/DefaultState",["common/MapResolver"],function(a){var b,c;return c={editor:{slideEditor:{buttonBar:{fontSize:72,fontFamily:"'Lato', sans-serif",fontColor:"grey",fontStyle:"",fontWeight:""}}}},b={get:function(b){return a.resolveItem(c,b)}}}),define("common/Queue",[],function(){function a(){this._queue=[]}function b(){return new a}return a.prototype={take:function(){return this._queue.length!=0?this._queue.shift():null},enqueue:function(a){this._queue.push(a)}},{create:b}}),define("common/Throttler",["common/Queue"],function(a){function b(b,c){this._handle=null,this._delay=b,this._queue=a.create(),this._context=c}return b.prototype={submit:function(a,b){this._handle?b&&this._handleFailedSubmit(a,b):this._internalSubmit(a,b)},_internalSubmit:function(a,b){var c=this;this._handle=setTimeout(function(){b&&b.arguments?a.apply(c._context,b.arguments):a.call(c._context),c._internalCB()},this._delay)},_internalCB:function(){var a=this._queue.take();if(a)this._handle=this._internalSubmit(a);else if(this._runLast){var b=this._runLast;this._runLast=null,this._handle=this._internalSubmit(b)}else this._handle=null},_handleFailedSubmit:function(a,b){switch(b.rejectionPolicy){case"queue":this._queue.enqueue(a);break;case"runLast":this._runLast=a;break;case"drop":}}},b}),define("ui/editor/raster/AbstractDrawer",[],function(){var a;return a=function(){function a(){}return a.name="AbstractDrawer",a.prototype.applyTransforms=function(a,b){var c,d,e,f,g;c=a.get("rotate"),this.g2d.translate(b.width/2+b.x,b.height/2+b.y),c!=null&&this.g2d.rotate(c),d=a.get("scale"),d!=null&&this.g2d.scale(d,d),e=a.get("skewX"),f=a.get("skewY");if(e||f)g=[1,0,0,1,0,0],e&&(g[2]=e),f&&(g[1]=f),this.g2d.transform.apply(this.g2d,g);return this.g2d.translate(-1*(b.width/2+b.x),-1*(b.height/2+b.y))},a}()});var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("ui/editor/raster/TextBoxDrawer",["./AbstractDrawer"],function(a){var b,c;return c=/<[^>]+>|<\/[^>]+>/,b=function(a){function b(a){this.g2d=a}return __extends(b,a),b.name="TextBoxDrawer",b.prototype.paint=function(a){var b,c,d,e,f,g=this;return this.g2d.fillStyle="#"+a.get("color"),d=a.get("size")*this.scale,this.g2d.font=d+"px "+a.get("family"),e=this._extractLines(a.get("text")),f=this._findWidestWidth(e)*this.scale,b={x:a.get("x")*this.scale,y:a.get("y")*this.scale,width:f+f,height:a.get("size")*this.scale},this.applyTransforms(a,b),c=0,e.forEach(function(a){if(a!=="")return g.g2d.fillText(a,b.x,b.y+b.height+c*d),++c})},b.prototype._extractLines=function(a){return a.split(c)},b.prototype._findWidestWidth=function(a){var b,c=this;return b=0,a.forEach(function(a){var d;d=c.g2d.measureText(a).width;if(d>b)return b=d}),b},b}(a)});var __hasProp={}.hasOwnProperty,__extends=function(a,b){function d(){this.constructor=a}for(var c in b)__hasProp.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};define("ui/editor/raster/ImageModelDrawer",["./AbstractDrawer"],function(a){var b;return b=function(a){function b(a){this.g2d=a}return __extends(b,a),b.name="ImageModelDrawer",b.prototype.paint=function(a){return this._imageLoaded(a.cachedImage,a)},b.prototype._imageLoaded=function(a,b){var c;return c={x:b.get("x")*this.scale,y:b.get("y")*this.scale,width:a.naturalWidth*this.scale,height:a.naturalHeight*this.scale},this.applyTransforms(b,c),this.g2d.drawImage(a,c.x,c.y,c.width,c.height)},b}(a)}),define("ui/editor/raster/SlideDrawer",["common/Throttler","./TextBoxDrawer","./ImageModelDrawer"],function(a,b,c){var d;return d=function(){function d(d,e){var f,g,h;this.model=d,this.g2d=e,this.model.on("contentsChanged",this.repaint,this),this.size={width:this.g2d.canvas.width,height:this.g2d.canvas.height},this.throttler=new a(600,this),this.scale=this.size.width/slideConfig.size.width,this.drawers={TextBox:new b(this.g2d),ImageModel:new c(this.g2d)},h=this.drawers;for(f in h)g=h[f],g.scale=this.scale}return d.name="SlideDrawer",d.prototype.resized=function(a){var b,c,d;this.size=a,this.scale=this.size.width/slideConfig.size.width,d=this.drawers;for(b in d)c=d[b],c.scale=this.scale;return this.repaint()},d.prototype.repaint=function(){return this.throttler.submit(this.paint,{rejectionPolicy:"runLast"})},d.prototype.paint=function(){var a,b=this;return this.g2d.clearRect(0,0,this.size.width,this.size.height),a=this.model.get("components"),a.forEach(function(a){var c;return c=a.get("type"),b.g2d.save(),b.drawers[c].paint(a),b.g2d.restore()})},d.prototype.dispose=function(){return this.model.off(null,null,this)},d}()}),define("model/system/Clipboard",["vendor/backbone"],function(a){return a.Model.extend()}),define("ui/editor/SlideCopyPaste",[],function(){var a;return a={cut:function(){var a;a=this.model.get("activeSlide");if(a!=null)return this._clipboard.set("item",a),this.model.removeSlide(a),a.set("selected",!1),!1},copy:function(){var a;a=this.model.get("activeSlide");if(a!=null)return this._clipboard.set("item",a.clone()),!1},paste:function(){var a,b;a=this._clipboard.get("item");if(a!=null)return b=a.clone(),b.set("x",null),b.set("y",null),this.model.addSlide(b)}}}),define("ui/widgets/DeltaDragControl",[],function(){var a,b;return b=["mousedown","mousemove","mouseup"],a=function(){function a(a,b){this.$el=a,this.stopProp=b,this.dragging=!1,this._mousemove=this.mousemove.bind(this),this._mouseup=this.mouseup.bind(this),this._mouseout=this._mouseup,$(document).bind("mousemove",this._mousemove),$(document).bind("mouseup",this._mouseup),this.$el.bind("mousedown",this.mousedown.bind(this)),this.$el.bind("mouseup",this._mouseup)}return a.name="DragControl",a.prototype.dispose=function(){return $(document).unbind("mousemove",this._mousemove),$(document).unbind("mouseup",this._mouseup)},a.prototype.mousedown=function(a){this.dragging=!0,this._startPos={x:a.pageX,y:a.pageY},this.$el.trigger("deltadragStart",{x:a.pageX,y:a.pageY});if(this.stopProp)return a.stopPropagation()},a.prototype.mousemove=function(a){var b,c;if(this.dragging){b=a.pageX-this._startPos.x,c=a.pageY-this._startPos.y,this.$el.trigger("deltadrag",[{dx:b,dy:c,x:a.pageX,y:a.pageY}]);if(this.stopProp)return a.stopPropagation()}},a.prototype.mouseup=function(a){return this.dragging=!1,!0},a}()}),define("ui/editor/components/TableView",function(){}),define("common/EventEmitter",[],function(){function a(){if(!(this instanceof a))return new a;this._events=null,typeof process!="undefined"&&typeof process.nextTick!="undefined"?this._deferer=function(a,b,c){process.nextTick(function(){a(b,c)})}:this._deferer=function(a,b,c){setTimeout(function(){a(b,c)},0)}}return a.prototype={_listeners:function(b){var c=this._events||(this._events={});return c[b]||(c[b]=[])},_emit:function(a,b){a instanceof Array&&(a=JSON.stringify(a));if(!this._events)return;var c=this._events[a];if(!c)return;var d=c.length;while(d--){var e=c[d];e&&e.cb.apply(e.context,b)}},_splice:function(a,b,c){return a=Array.prototype.slice.call(a),a.splice(b,c)},_indexOfSub:function(a,b,c){for(var d=0;d<a.length;++d)if(a[d].cb===b&&a[d].context===c)return d;return-1},emit:function(a){var b=arguments.length>1?this._splice(arguments,1,arguments.length):[];this._emit(a,b)},trigger:function(){this.emit.apply(this,arguments)},emitDeferred:function(a){var b=arguments.length>1?this._splice(arguments,1,arguments.length):[];this._deferer(emit,a,b)},on:function(a,b,c){if(!b)throw"Undefined callback provided";a instanceof Array&&(a=JSON.stringify(a));var d=this._listeners(a),e=this._indexOfSub(d,b,c);e<0&&(d.push({cb:b,context:c}),e=d.length-1);var f=this;return{dispose:function(){f.removeListener(a,b,c)}}},once:function(a,b,c){var d={sub:null};return d.sub=this.on(a,function(){d.sub.dispose(),b.apply(c,arguments)}),d.sub},removeListener:function(a,b,c){var d=this._listeners(a),e=this._indexOfSub(d,b,c);0<=e&&d.splice(e,1),d.length==0&&delete this._events[a]},getNumListeners:function(a){var b=0;return this._events[a]&&(b=this._events[a].length),b},off:function(a,b,c){this.removeListener(a,b,c)},removeAllListeners:function(){this._events=null}},a}),define("ui/editor/button_bar/AbstractButtonBarView",["vendor/backbone"],function(a){return a.View.extend({initialize:function(a){return this.buttonBarOptions=a},optionChosen:function(a){var b;return b=$(a.currentTarget).attr("data-option"),this.buttonBarOptions[b].call(this,a)}})}),define("model/editor/button_bar/ButtonBarModel",["vendor/backbone"],function(a){var b,c,d,e,f,g,h;c=["size","family","color","style","weight","decoration"],f=function(a){return c.indexOf(a)>2},b={};for(g=0,h=c.length;g<h;g++)e=c[g],d="font"+e.substr(0,1).toUpperCase()+e.substr(1),b[d]=function(){var a,b;return a=d,b=e,function(c){var d;if(this._activeIsTextbox())return console.log("Setting: "+a+" "+b+" "+c),d=this.get(a),d===c&&f(b)&&(c=""),b==="size"&&(c|=0),this.set(a,c),this.activeComponent.set(b,c)}}();return a.Model.extend({initialize:function(){return this.fetch({keyTrail:["editor","slideEditor","buttonBar"]}),_.extend(this,b)},fontConfig:function(){return{size:this.get("fontSize"),family:this.get("fontFamily"),color:this.get("fontColor"),style:this.get("fontStyle"),weight:this.get("fontWeight"),decoration:this.get("fontDecoration"),x:Math.min(1024,window.innerWidth)/2-150,y:Math.min(768,window.innerHeight)/2-80,z:0}},imgConfig:function(a){return{src:a,x:window.innerWidth/2-150,y:window.innerHeight/2-80,z:0}},textAlign:function(a){this.set("textAlign",a);if(this._activeIsTextbox())return this.activeComponent.set("align",a)},_activeIsTextbox:function(){return this.activeComponent&&this.activeComponent.get("type")==="TextBox"},_pullFontSettings:function(){var a,b,d,e;e=[];for(b=0,d=c.length;b<d;b++)a=c[b],e.push(this.set("font"+a.substr(0,1).toUpperCase()+a.substr(1),this.activeComponent.get(a)));return e},colorSelected:function(a){this.set("fontColor",a);if(this._activeIsTextbox())return this.activeComponent.set("color",a)},activeComponentChanged:function(a){this.activeComponent=a;if(this._activeIsTextbox())return this._pullFontSettings()},constructor:function(){a.Model.prototype.constructor.apply(this,arguments)}})}),define("common/Calcium",["vendor/backbone"],function(a){function b(b){return b instanceof a.Model||b instanceof a.Collection}function e(a,b,c){this.args=c,this.obj=a,this.fn=b}var c=a.Model.extend({toJSON:function(c,d){if(c)return a.Model.prototype.toJSON.apply(this,arguments);var e={};for(var f in this.attributes){var g=this.attributes[f];if(b(g))e[f]=g.toJSON(c,d);else if(d&&g instanceof Array){console.log("INSPECTING ARRAY");var h=[];e[f]=h,g.forEach(function(a,e){b(a)?h.push(a.toJSON(c,d)):h.push(a)})}else e[f]=g}return e}}),d=a.Collection.extend({toJSON:function(b,c){if(b)return a.Collection.prototype.toJSON.apply(this,arguments);var d=[];return this.models.forEach(function(a,e){d.push(a.toJSON(b,c))}),d}});return e.prototype={dispose:function(){this.fn.apply(this.obj,this.args)}},{Model:c,Collection:d}}),define("model/geom/SpatialObject",["common/Calcium"],function(a){return a.Model.extend({initialize:function(){},constructor:function(){a.Model.prototype.constructor.apply(this,arguments)}})}),define("model/presentation/components/Component",["model/geom/SpatialObject"],function(a){return a.extend({initialize:function(){},dispose:function(){return this.trigger("dispose",this),this.off()},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("model/presentation/components/Image",["./Component"],function(a){return a.extend({initialize:function(){return this.set("type","ImageModel"),this.on("change:src",this._updateCache,this),this.cachedImage=new Image,this._updateCache()},_updateCache:function(){return this.cachedImage.src=this.get("src"),console.log(this.get("src"))},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("model/presentation/components/Table",function(){}),define("model/presentation/components/TextBox",["./Component"],function(a){return a.extend({initialize:function(){this.set("type","TextBox");if(this.get("text")==null)return this.set("text","Text")},textWithBreaks:function(){},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("model/presentation/components/ComponentFactory",["./Image","./Table","./TextBox"],function(a,b,c){var d;return d={createTextBox:function(a){return new c(a)},createImage:function(b){return new a(b)}}}),define("ui/editor/button_bar/ButtonBarView",["./AbstractButtonBarView","model/editor/button_bar/ButtonBarModel","model/presentation/components/ComponentFactory"],function(a,b,c){var d,e;return e=["size","family","weight","style","decoration"],d={_extractValue:function(a){var b,c;return c=a.target.dataset.value,c==null&&(b=$(a.target),c=b.parent()[0].dataset.value),c},createSlide:function(){return this.deck.newSlide()},textBox:function(){var a;a=this.deck.get("activeSlide");if(a!=null)return a.add(c.createTextBox(this.model.fontConfig()))},picture:function(){var a,b=this;a=this.deck.get("activeSlide");if(a!=null)return this.options.pictureGrabber.show(function(d){return a.add(c.createImage(b.model.imgConfig(d)))})},table:function(){},shapes:function(){},chart:function(){},transitionEditor:function(){return this.$el.trigger("changePerspective",{perspective:"transitionEditor"})},preview:function(){return this.$el.trigger("preview")},textAlign:function(a){return this.model.textAlign(a.currentTarget.dataset.value)}},e.forEach(function(a){var b;return b="font"+a.substr(0,1).toUpperCase()+a.substr(1),d[b]=function(){var a;return a=b,function(b){var c;return c=d._extractValue(b),this.model[a](c)}}()}),a.extend({events:function(){return{"click *[data-option]":"optionChosen"}},initialize:function(){return a.prototype.initialize.call(this,d),this.deck=this.options.deck,this.deck.on("change:activeSlide",this.activeSlideChanged,this),this.model=new b,this.model.on("change:fontSize",this._fontSizeChanged,this),this.model.on("change:fontFamily",this._fontFamilyChanged,this)},_fontFamilyChanged:function(a,b){return b=b.substr(b.indexOf("'")+1,b.lastIndexOf("'")-1),this.$el.find(".fontFamilyBtn .text").text(b)},_fontSizeChanged:function(a,b){return this.$el.find(".fontSizeBtn .text").text(b)},activeSlideChanged:function(a,b){this.currentSlide&&this.currentSlide.off("change:activeSlide",this.activeSlideChanged,this),this.currentSlide=b;if(b)return b.on("change:activeComponent",this.activeComponentChanged,this)},activeComponentChanged:function(a,b){return this.model.activeComponentChanged(b),b?this.$el.find(".fontButton").removeClass("disabled"):this.$el.find(".fontButton").addClass("disabled")},dispose:function(){return this.currentSlide&&this.currentSlide.off("change:activeSlide",this.activeSlideChanged,this),this.deck.off("change:activeSlide",this.activeSlideChanged,this)},render:function(){var a,b=this;return a=this.$el.find(".color-chooser"),a.ColorPicker({onChange:function(c,d,e){return a.find("div").css("backgroundColor","#"+d),b.model.colorSelected(d)}}),this.$el}})}),define("vendor/Handlebars",[],function(){var a={};a.VERSION="1.0.beta.6",a.helpers={},a.partials={},a.registerHelper=function(a,b,c){c&&(b.not=c),this.helpers[a]=b},a.registerPartial=function(a,b){this.partials[a]=b},a.registerHelper("helperMissing",function(a){if(arguments.length===2)return undefined;throw new Error("Could not find property '"+a+"'")});var b=Object.prototype.toString,c="[object Function]";a.registerHelper("blockHelperMissing",function(a,d){var e=d.inverse||function(){},f=d.fn,g="",h=b.call(a);h===c&&(a=a.call(this));if(a===!0)return f(this);if(a===!1||a==null)return e(this);if(a instanceof Array){if(a.length>0)for(var i=0,j=a.length;i<j;i++)g+=f(a[i]);else g=e(this);return g}return f(a)}),a.registerHelper("each",function(a,b){var c=b.fn,d=b.inverse,e="";if(a&&a.length>0)for(var f=0,g=a.length;f<g;f++)e+=c(a[f]);else e=d(this);return e}),a.registerHelper("if",function(d,e){var f=b.call(d);return f===c&&(d=d.call(this)),!d||a.Utils.isEmpty(d)?e.inverse(this):e.fn(this)}),a.registerHelper("unless",function(b,c){var d=c.fn,e=c.inverse;return c.fn=e,c.inverse=d,a.helpers["if"].call(this,b,c)}),a.registerHelper("with",function(a,b){return b.fn(a)}),a.registerHelper("log",function(b){a.log(b)});var d=function(){var a={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,statements:6,simpleInverse:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,OPEN_PARTIAL:24,params:25,hash:26,param:27,STRING:28,INTEGER:29,BOOLEAN:30,hashSegments:31,hashSegment:32,ID:33,EQUALS:34,pathSegments:35,SEP:36,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"OPEN_PARTIAL",28:"STRING",29:"INTEGER",30:"BOOLEAN",33:"ID",34:"EQUALS",36:"SEP"},productions_:[0,[3,2],[4,3],[4,1],[4,0],[6,1],[6,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[7,2],[17,3],[17,2],[17,2],[17,1],[25,2],[25,1],[27,1],[27,1],[27,1],[27,1],[26,1],[31,2],[31,1],[32,3],[32,3],[32,3],[32,3],[21,1],[35,3],[35,1]],performAction:function(b,c,d,e,f,g,h){var i=g.length-1;switch(f){case 1:return g[i-1];case 2:this.$=new e.ProgramNode(g[i-2],g[i]);break;case 3:this.$=new e.ProgramNode(g[i]);break;case 4:this.$=new e.ProgramNode([]);break;case 5:this.$=[g[i]];break;case 6:g[i-1].push(g[i]),this.$=g[i-1];break;case 7:this.$=new e.InverseNode(g[i-2],g[i-1],g[i]);break;case 8:this.$=new e.BlockNode(g[i-2],g[i-1],g[i]);break;case 9:this.$=g[i];break;case 10:this.$=g[i];break;case 11:this.$=new e.ContentNode(g[i]);break;case 12:this.$=new e.CommentNode(g[i]);break;case 13:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 14:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 15:this.$=g[i-1];break;case 16:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1]);break;case 17:this.$=new e.MustacheNode(g[i-1][0],g[i-1][1],!0);break;case 18:this.$=new e.PartialNode(g[i-1]);break;case 19:this.$=new e.PartialNode(g[i-2],g[i-1]);break;case 20:break;case 21:this.$=[[g[i-2]].concat(g[i-1]),g[i]];break;case 22:this.$=[[g[i-1]].concat(g[i]),null];break;case 23:this.$=[[g[i-1]],g[i]];break;case 24:this.$=[[g[i]],null];break;case 25:g[i-1].push(g[i]),this.$=g[i-1];break;case 26:this.$=[g[i]];break;case 27:this.$=g[i];break;case 28:this.$=new e.StringNode(g[i]);break;case 29:this.$=new e.IntegerNode(g[i]);break;case 30:this.$=new e.BooleanNode(g[i]);break;case 31:this.$=new e.HashNode(g[i]);break;case 32:g[i-1].push(g[i]),this.$=g[i-1];break;case 33:this.$=[g[i]];break;case 34:this.$=[g[i-2],g[i]];break;case 35:this.$=[g[i-2],new e.StringNode(g[i])];break;case 36:this.$=[g[i-2],new e.IntegerNode(g[i])];break;case 37:this.$=[g[i-2],new e.BooleanNode(g[i])];break;case 38:this.$=new e.IdNode(g[i]);break;case 39:g[i-2].push(g[i]),this.$=g[i-2];break;case 40:this.$=[g[i]]}},table:[{3:1,4:2,5:[2,4],6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{1:[3]},{5:[1,16]},{5:[2,3],7:17,8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,19],20:[2,3],22:[1,13],23:[1,14],24:[1,15]},{5:[2,5],14:[2,5],15:[2,5],16:[2,5],19:[2,5],20:[2,5],22:[2,5],23:[2,5],24:[2,5]},{4:20,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{4:21,6:3,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,4],22:[1,13],23:[1,14],24:[1,15]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],24:[2,9]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],24:[2,10]},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],24:[2,11]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],24:[2,12]},{17:22,21:23,33:[1,25],35:24},{17:26,21:23,33:[1,25],35:24},{17:27,21:23,33:[1,25],35:24},{17:28,21:23,33:[1,25],35:24},{21:29,33:[1,25],35:24},{1:[2,1]},{6:30,8:4,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],22:[1,13],23:[1,14],24:[1,15]},{5:[2,6],14:[2,6],15:[2,6],16:[2,6],19:[2,6],20:[2,6],22:[2,6],23:[2,6],24:[2,6]},{17:22,18:[1,31],21:23,33:[1,25],35:24},{10:32,20:[1,33]},{10:34,20:[1,33]},{18:[1,35]},{18:[2,24],21:40,25:36,26:37,27:38,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,38],28:[2,38],29:[2,38],30:[2,38],33:[2,38],36:[1,46]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],36:[2,40]},{18:[1,47]},{18:[1,48]},{18:[1,49]},{18:[1,50],21:51,33:[1,25],35:24},{5:[2,2],8:18,9:5,11:6,12:7,13:8,14:[1,9],15:[1,10],16:[1,12],19:[1,11],20:[2,2],22:[1,13],23:[1,14],24:[1,15]},{14:[2,20],15:[2,20],16:[2,20],19:[2,20],22:[2,20],23:[2,20],24:[2,20]},{5:[2,7],14:[2,7],15:[2,7],16:[2,7],19:[2,7],20:[2,7],22:[2,7],23:[2,7],24:[2,7]},{21:52,33:[1,25],35:24},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],24:[2,8]},{14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],24:[2,14]},{18:[2,22],21:40,26:53,27:54,28:[1,41],29:[1,42],30:[1,43],31:39,32:44,33:[1,45],35:24},{18:[2,23]},{18:[2,26],28:[2,26],29:[2,26],30:[2,26],33:[2,26]},{18:[2,31],32:55,33:[1,56]},{18:[2,27],28:[2,27],29:[2,27],30:[2,27],33:[2,27]},{18:[2,28],28:[2,28],29:[2,28],30:[2,28],33:[2,28]},{18:[2,29],28:[2,29],29:[2,29],30:[2,29],33:[2,29]},{18:[2,30],28:[2,30],29:[2,30],30:[2,30],33:[2,30]},{18:[2,33],33:[2,33]},{18:[2,40],28:[2,40],29:[2,40],30:[2,40],33:[2,40],34:[1,57],36:[2,40]},{33:[1,58]},{14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],24:[2,13]},{5:[2,16],14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],24:[2,16]},{5:[2,17],14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],24:[2,17]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],24:[2,18]},{18:[1,59]},{18:[1,60]},{18:[2,21]},{18:[2,25],28:[2,25],29:[2,25],30:[2,25],33:[2,25]},{18:[2,32],33:[2,32]},{34:[1,57]},{21:61,28:[1,62],29:[1,63],30:[1,64],33:[1,25],35:24},{18:[2,39],28:[2,39],29:[2,39],30:[2,39],33:[2,39],36:[2,39]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],24:[2,19]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],24:[2,15]},{18:[2,34],33:[2,34]},{18:[2,35],33:[2,35]},{18:[2,36],33:[2,36]},{18:[2,37],33:[2,37]}],defaultActions:{16:[2,1],37:[2,23],53:[2,21]},parseError:function(b,c){throw new Error(b)},parse:function(b){function o(a){d.length=d.length-2*a,e.length=e.length-a,f.length=f.length-a}function p(){var a;return a=c.lexer.lex()||1,typeof a!="number"&&(a=c.symbols_[a]||a),a}var c=this,d=[0],e=[null],f=[],g=this.table,h="",i=0,j=0,k=0,l=2,m=1;this.lexer.setInput(b),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,typeof this.lexer.yylloc=="undefined"&&(this.lexer.yylloc={});var n=this.lexer.yylloc;f.push(n),typeof this.yy.parseError=="function"&&(this.parseError=this.yy.parseError);var q,r,s,t,u,v,w={},x,y,z,A;for(;;){s=d[d.length-1],this.defaultActions[s]?t=this.defaultActions[s]:(q==null&&(q=p()),t=g[s]&&g[s][q]);if(typeof t=="undefined"||!t.length||!t[0])if(!k){A=[];for(x in g[s])this.terminals_[x]&&x>2&&A.push("'"+this.terminals_[x]+"'");var B="";this.lexer.showPosition?B="Parse error on line "+(i+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+A.join(", ")+", got '"+this.terminals_[q]+"'":B="Parse error on line "+(i+1)+": Unexpected "+(q==1?"end of input":"'"+(this.terminals_[q]||q)+"'"),this.parseError(B,{text:this.lexer.match,token:this.terminals_[q]||q,line:this.lexer.yylineno,loc:n,expected:A})}if(t[0]instanceof Array&&t.length>1)throw new Error("Parse Error: multiple actions possible at state: "+s+", token: "+q);switch(t[0]){case 1:d.push(q),e.push(this.lexer.yytext),f.push(this.lexer.yylloc),d.push(t[1]),q=null,r?(q=r,r=null):(j=this.lexer.yyleng,h=this.lexer.yytext,i=this.lexer.yylineno,n=this.lexer.yylloc,k>0&&k--);break;case 2:y=this.productions_[t[1]][1],w.$=e[e.length-y],w._$={first_line:f[f.length-(y||1)].first_line,last_line:f[f.length-1].last_line,first_column:f[f.length-(y||1)].first_column,last_column:f[f.length-1].last_column},v=this.performAction.call(w,h,j,i,this.yy,t[1],e,f);if(typeof v!="undefined")return v;y&&(d=d.slice(0,-1*y*2),e=e.slice(0,-1*y),f=f.slice(0,-1*y)),d.push(this.productions_[t[1]][0]),e.push(w.$),f.push(w._$),z=g[d[d.length-2]][d[d.length-1]],d.push(z);break;case 3:return!0}}return!0}},b=function(){var a={EOF:1,parseError:function(b,c){if(!this.yy.parseError)throw new Error(b);this.yy.parseError(b,c)},setInput:function(a){return this._input=a,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this},input:function(){var a=this._input[0];this.yytext+=a,this.yyleng++,this.match+=a,this.matched+=a;var b=a.match(/\n/);return b&&this.yylineno++,this._input=this._input.slice(1),a},unput:function(a){return this._input=a+this._input,this},more:function(){return this._more=!0,this},pastInput:function(){var a=this.matched.substr(0,this.matched.length-this.match.length);return(a.length>20?"...":"")+a.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var a=this.match;return a.length<20&&(a+=this._input.substr(0,20-a.length)),(a.substr(0,20)+(a.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var a=this.pastInput(),b=(new Array(a.length+1)).join("-");return a+this.upcomingInput()+"\n"+b+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var a,b,c,d;this._more||(this.yytext="",this.match="");var e=this._currentRules();for(var f=0;f<e.length;f++){b=this._input.match(this.rules[e[f]]);if(b){d=b[0].match(/\n.*/g),d&&(this.yylineno+=d.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:d?d[d.length-1].length-1:this.yylloc.last_column+b[0].length},this.yytext+=b[0],this.match+=b[0],this.matches=b,this.yyleng=this.yytext.length,this._more=!1,this._input=this._input.slice(b[0].length),this.matched+=b[0],a=this.performAction.call(this,this.yy,this,e[f],this.conditionStack[this.conditionStack.length-1]);if(a)return a;return}}if(this._input==="")return this.EOF;this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var b=this.next();return typeof b!="undefined"?b:this.lex()},begin:function(b){this.conditionStack.push(b)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(b){this.begin(b)}};return a.performAction=function(b,c,d,e){var f=e;switch(d){case 0:c.yytext.slice(-1)!=="\\"&&this.begin("mu"),c.yytext.slice(-1)==="\\"&&(c.yytext=c.yytext.substr(0,c.yyleng-1),this.begin("emu"));if(c.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return 24;case 4:return 16;case 5:return 20;case 6:return 19;case 7:return 19;case 8:return 23;case 9:return 23;case 10:return c.yytext=c.yytext.substr(3,c.yyleng-5),this.popState(),15;case 11:return 22;case 12:return 34;case 13:return 33;case 14:return 33;case 15:return 36;case 16:break;case 17:return this.popState(),18;case 18:return this.popState(),18;case 19:return c.yytext=c.yytext.substr(1,c.yyleng-2).replace(/\\"/g,'"'),28;case 20:return 30;case 21:return 30;case 22:return 29;case 23:return 33;case 24:return c.yytext=c.yytext.substr(1,c.yyleng-2),33;case 25:return"INVALID";case 26:return 5}},a.rules=[/^[^\x00]*?(?=(\{\{))/,/^[^\x00]+/,/^[^\x00]{2,}?(?=(\{\{))/,/^\{\{>/,/^\{\{#/,/^\{\{\//,/^\{\{\^/,/^\{\{\s*else\b/,/^\{\{\{/,/^\{\{&/,/^\{\{![\s\S]*?\}\}/,/^\{\{/,/^=/,/^\.(?=[} ])/,/^\.\./,/^[\/.]/,/^\s+/,/^\}\}\}/,/^\}\}/,/^"(\\["]|[^"])*"/,/^true(?=[}\s])/,/^false(?=[}\s])/,/^[0-9]+(?=[}\s])/,/^[a-zA-Z0-9_$-]+(?=[=}\s\/.])/,/^\[[^\]]*\]/,/^./,/^$/],a.conditions={mu:{rules:[3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26],inclusive:!1},emu:{rules:[2],inclusive:!1},INITIAL:{rules:[0,1,26],inclusive:!0}},a}();return a.lexer=b,a}();return a.Parser=d,a.parse=function(b){return a.Parser.yy=a.AST,a.Parser.parse(b)},a.print=function(b){return(new a.PrintVisitor).accept(b)},a.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(a,b){}},a.log=function(b,c){a.logger.log(b,c)},function(){a.AST={},a.AST.ProgramNode=function(b,c){this.type="program",this.statements=b,c&&(this.inverse=new a.AST.ProgramNode(c))},a.AST.MustacheNode=function(a,b,c){this.type="mustache",this.id=a[0],this.params=a.slice(1),this.hash=b,this.escaped=!c},a.AST.PartialNode=function(a,b){this.type="partial",this.id=a,this.context=b};var b=function(b,c){if(b.original!==c.original)throw new a.Exception(b.original+" doesn't match "+c.original)};a.AST.BlockNode=function(a,c,d){b(a.id,d),this.type="block",this.mustache=a,this.program=c},a.AST.InverseNode=function(a,c,d){b(a.id,d),this.type="inverse",this.mustache=a,this.program=c},a.AST.ContentNode=function(a){this.type="content",this.string=a},a.AST.HashNode=function(a){this.type="hash",this.pairs=a},a.AST.IdNode=function(a){this.type="ID",this.original=a.join(".");var b=[],c=0;for(var d=0,e=a.length;d<e;d++){var f=a[d];f===".."?c++:f==="."||f==="this"?this.isScoped=!0:b.push(f)}this.parts=b,this.string=b.join("."),this.depth=c,this.isSimple=b.length===1&&c===0},a.AST.StringNode=function(a){this.type="STRING",this.string=a},a.AST.IntegerNode=function(a){this.type="INTEGER",this.integer=a},a.AST.BooleanNode=function(a){this.type="BOOLEAN",this.bool=a},a.AST.CommentNode=function(a){this.type="comment",this.comment=a}}(),a.Exception=function(a){var b=Error.prototype.constructor.apply(this,arguments);for(var c in b)b.hasOwnProperty(c)&&(this[c]=b[c]);this.message=b.message},a.Exception.prototype=new Error,a.SafeString=function(a){this.string=a},a.SafeString.prototype.toString=function(){return this.string.toString()},function(){var b={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},c=/&(?!\w+;)|[<>"'`]/g,d=/[&<>"'`]/,e=function(a){return b[a]||"&amp;"};a.Utils={escapeExpression:function(b){return b instanceof a.SafeString?b.toString():b==null||b===!1?"":d.test(b)?b.replace(c,e):b},isEmpty:function(a){return typeof a=="undefined"?!0:a===null?!0:a===!1?!0:a instanceof Array?!0:!1}}}(),a.Compiler=function(){},a.JavaScriptCompiler=function(){},function(b,c){b.OPCODE_MAP={appendContent:1,getContext:2,lookupWithHelpers:3,lookup:4,append:5,invokeMustache:6,appendEscaped:7,pushString:8,truthyOrFallback:9,functionOrFallback:10,invokeProgram:11,invokePartial:12,push:13,assignToHash:15,pushStringParam:16},b.MULTI_PARAM_OPCODES={appendContent:1,getContext:1,lookupWithHelpers:2,lookup:1,invokeMustache:3,pushString:1,truthyOrFallback:1,functionOrFallback:1,invokeProgram:3,invokePartial:1,push:1,assignToHash:1,pushStringParam:1},b.DISASSEMBLE_MAP={};for(var d in b.OPCODE_MAP){var e=b.OPCODE_MAP[d];b.DISASSEMBLE_MAP[e]=d}b.multiParamSize=function(a){return b.MULTI_PARAM_OPCODES[b.DISASSEMBLE_MAP[a]]},b.prototype={compiler:b,disassemble:function(){var a=this.opcodes,c,d,e=[],f,g,h;for(var i=0,j=a.length;i<j;i++){c=a[i];if(c==="DECLARE")g=a[++i],h=a[++i],e.push("DECLARE "+g+" = "+h);else{f=b.DISASSEMBLE_MAP[c];var k=b.multiParamSize(c),l=[];for(var m=0;m<k;m++)d=a[++i],typeof d=="string"&&(d='"'+d.replace("\n","\\n")+'"'),l.push(d);f=f+" "+l.join(" "),e.push(f)}}return e.join("\n")},guid:0,compile:function(a,b){this.children=[],this.depths={list:[]},this.options=b;var c=this.options.knownHelpers;this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,"if":!0,unless:!0,"with":!0,log:!0};if(c)for(var d in c)this.options.knownHelpers[d]=c[d];return this.program(a)},accept:function(a){return this[a.type](a)},program:function(a){var b=a.statements,c;this.opcodes=[];for(var d=0,e=b.length;d<e;d++)c=b[d],this[c.type](c);return this.isSimple=e===1,this.depths.list=this.depths.list.sort(function(a,b){return a-b}),this},compileProgram:function(a){var b=(new this.compiler).compile(a,this.options),c=this.guid++;this.usePartial=this.usePartial||b.usePartial,this.children[c]=b;for(var d=0,e=b.depths.list.length;d<e;d++){depth=b.depths.list[d];if(depth<2)continue;this.addDepth(depth-1)}return c},block:function(a){var b=a.mustache,c,d,e,f,g=this.setupStackForMustache(b),h=this.compileProgram(a.program);a.program.inverse&&(f=this.compileProgram(a.program.inverse),this.declare("inverse",f)),this.opcode("invokeProgram",h,g.length,!!b.hash),this.declare("inverse",null),this.opcode("append")},inverse:function(a){var b=this.setupStackForMustache(a.mustache),c=this.compileProgram(a.program);this.declare("inverse",c),this.opcode("invokeProgram",null,b.length,!!a.mustache.hash),this.declare("inverse",null),this.opcode("append")},hash:function(a){var b=a.pairs,c,d;this.opcode("push","{}");for(var e=0,f=b.length;e<f;e++)c=b[e],d=c[1],this.accept(d),this.opcode("assignToHash",c[0])},partial:function(a){var b=a.id;this.usePartial=!0,a.context?this.ID(a.context):this.opcode("push","depth0"),this.opcode("invokePartial",b.original),this.opcode("append")},content:function(a){this.opcode("appendContent",a.string)},mustache:function(a){var b=this.setupStackForMustache(a);this.opcode("invokeMustache",b.length,a.id.original,!!a.hash),a.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ID:function(a){this.addDepth(a.depth),this.opcode("getContext",a.depth),this.opcode("lookupWithHelpers",a.parts[0]||null,a.isScoped||!1);for(var b=1,c=a.parts.length;b<c;b++)this.opcode("lookup",a.parts[b])},STRING:function(a){this.opcode("pushString",a.string)},INTEGER:function(a){this.opcode("push",a.integer)},BOOLEAN:function(a){this.opcode("push",a.bool)},comment:function(){},pushParams:function(a){var b=a.length,c;while(b--)c=a[b],this.options.stringParams?(c.depth&&this.addDepth(c.depth),this.opcode("getContext",c.depth||0),this.opcode("pushStringParam",c.string)):this[c.type](c)},opcode:function(a,c,d,e){this.opcodes.push(b.OPCODE_MAP[a]),c!==undefined&&this.opcodes.push(c),d!==undefined&&this.opcodes.push(d),e!==undefined&&this.opcodes.push(e)},declare:function(a,b){this.opcodes.push("DECLARE"),this.opcodes.push(a),this.opcodes.push(b)},addDepth:function(a){if(a===0)return;this.depths[a]||(this.depths[a]=!0,this.depths.list.push(a))},setupStackForMustache:function(a){var b=a.params;return this.pushParams(b),a.hash&&this.hash(a.hash),this.ID(a.id),b}},c.prototype={nameLookup:function(a,b,d){return/^[0-9]+$/.test(b)?a+"["+b+"]":c.isValidJavaScriptVariableName(b)?a+"."+b:a+"['"+b+"']"},appendToBuffer:function(a){return this.environment.isSimple?"return "+a+";":"buffer += "+a+";"},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(a,b,c,d){this.environment=a,this.options=b||{},this.name=this.environment.name,this.isChild=!!c,this.context=c||{programs:[],aliases:{self:"this"},registers:{list:[]}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.compileChildren(a,b);var e=a.opcodes,f;this.i=0;for(i=e.length;this.i<i;this.i++)f=this.nextOpcode(0),f[0]==="DECLARE"?(this.i=this.i+2,this[f[1]]=f[2]):(this.i=this.i+f[1].length,this[f[0]].apply(this,f[1]));return this.createFunctionContext(d)},nextOpcode:function(a){var c=this.environment.opcodes,d=c[this.i+a],e,f,g,h;if(d==="DECLARE")return e=c[this.i+1],f=c[this.i+2],["DECLARE",e,f];e=b.DISASSEMBLE_MAP[d],g=b.multiParamSize(d),h=[];for(var i=0;i<g;i++)h.push(c[this.i+i+1+a]);return[e,h]},eat:function(a){this.i=this.i+a.length},preamble:function(){var a=[];this.useRegister("foundHelper");if(!this.isChild){var b=this.namespace,c="helpers = helpers || "+b+".helpers;";this.environment.usePartial&&(c=c+" partials = partials || "+b+".partials;"),a.push(c)}else a.push("");this.environment.isSimple?a.push(""):a.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=a},createFunctionContext:function(b){var c=this.stackVars;this.isChild||(c=c.concat(this.context.registers.list)),c.length>0&&(this.source[1]=this.source[1]+", "+c.join(", "));if(!this.isChild){var d=[];for(var e in this.context.aliases)this.source[1]=this.source[1]+", "+e+"="+this.context.aliases[e]}this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");var f=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"];for(var g=0,h=this.environment.depths.list.length;g<h;g++)f.push("depth"+this.environment.depths.list[g]);if(b)return f.push(this.source.join("\n  ")),Function.apply(this,f);var i="function "+(this.name||"")+"("+f.join(",")+") {\n  "+this.source.join("\n  ")+"}";return a.log(a.logger.DEBUG,i+"\n\n"),i},appendContent:function(a){this.source.push(this.appendToBuffer(this.quotedString(a)))},append:function(){var a=this.popStack();this.source.push("if("+a+" || "+a+" === 0) { "+this.appendToBuffer(a)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){var a=this.nextOpcode(1),b="";this.context.aliases.escapeExpression="this.escapeExpression",a[0]==="appendContent"&&(b=" + "+this.quotedString(a[1][0]),this.eat(a)),this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"+b))},getContext:function(a){this.lastContext!==a&&(this.lastContext=a)},lookupWithHelpers:function(a,b){if(a){var c=this.nextStack();this.usingKnownHelper=!1;var d;!b&&this.options.knownHelpers[a]?(d=c+" = "+this.nameLookup("helpers",a,"helper"),this.usingKnownHelper=!0):b||this.options.knownHelpersOnly?d=c+" = "+this.nameLookup("depth"+this.lastContext,a,"context"):(this.register("foundHelper",this.nameLookup("helpers",a,"helper")),d=c+" = foundHelper || "+this.nameLookup("depth"+this.lastContext,a,"context")),d+=";",this.source.push(d)}else this.pushStack("depth"+this.lastContext)},lookup:function(a){var b=this.topStack();this.source.push(b+" = ("+b+" === null || "+b+" === undefined || "+b+" === false ? "+b+" : "+this.nameLookup(b,a,"context")+");")},pushStringParam:function(a){this.pushStack("depth"+this.lastContext),this.pushString(a)},pushString:function(a){this.pushStack(this.quotedString(a))},push:function(a){this.pushStack(a)},invokeMustache:function(a,b,c){this.populateParams(a,this.quotedString(b),"{}",null,c,function(a,b,c){this.usingKnownHelper||(this.context.aliases.helperMissing="helpers.helperMissing",this.context.aliases.undef="void 0",this.source.push("else if("+c+"=== undef) { "+a+" = helperMissing.call("+b+"); }"),a!==c&&this.source.push("else { "+a+" = "+c+"; }"))})},invokeProgram:function(a,b,c){var d=this.programExpression(this.inverse),e=this.programExpression(a);this.populateParams(b,null,e,d,c,function(a,b,c){this.usingKnownHelper||(this.context.aliases.blockHelperMissing="helpers.blockHelperMissing",this.source.push("else { "+a+" = blockHelperMissing.call("+b+"); }"))})},populateParams:function(a,b,c,d,e,f){var g=e||this.options.stringParams||d||this.options.data,h=this.popStack(),i,j=[],k,l,m;g?(this.register("tmp1",c),m="tmp1"):m="{ hash: {} }";if(g){var n=e?this.popStack():"{}";this.source.push("tmp1.hash = "+n+";")}this.options.stringParams&&this.source.push("tmp1.contexts = [];");for(var o=0;o<a;o++)k=this.popStack(),j.push(k),this.options.stringParams&&this.source.push("tmp1.contexts.push("+this.popStack()+");");d&&(this.source.push("tmp1.fn = tmp1;"),this.source.push("tmp1.inverse = "+d+";")),this.options.data&&this.source.push("tmp1.data = data;"),j.push(m),this.populateCall(j,h,b||h,f,c!=="{}")},populateCall:function(a,b,c,d,e){var f=["depth0"].concat(a).join(", "),g=["depth0"].concat(c).concat(a).join(", "),h=this.nextStack();if(this.usingKnownHelper)this.source.push(h+" = "+b+".call("+f+");");else{this.context.aliases.functionType='"function"';var i=e?"foundHelper && ":"";this.source.push("if("+i+"typeof "+b+" === functionType) { "+h+" = "+b+".call("+f+"); }")}d.call(this,h,g,b),this.usingKnownHelper=!1},invokePartial:function(a){params=[this.nameLookup("partials",a,"partial"),"'"+a+"'",this.popStack(),"helpers","partials"],this.options.data&&params.push("data"),this.pushStack("self.invokePartial("+params.join(", ")+");")},assignToHash:function(a){var b=this.popStack(),c=this.topStack();this.source.push(c+"['"+a+"'] = "+b+";")},compiler:c,compileChildren:function(a,b){var c=a.children,d,e;for(var f=0,g=c.length;f<g;f++){d=c[f],e=new this.compiler,this.context.programs.push("");var h=this.context.programs.length;d.index=h,d.name="program"+h,this.context.programs[h]=e.compile(d,b,this.context)}},programExpression:function(a){if(a==null)return"self.noop";var b=this.environment.children[a],c=b.depths.list,d=[b.index,b.name,"data"];for(var e=0,f=c.length;e<f;e++)depth=c[e],depth===1?d.push("depth0"):d.push("depth"+(depth-1));return c.length===0?"self.program("+d.join(", ")+")":(d.shift(),"self.programWithDepth("+d.join(", ")+")")},register:function(a,b){this.useRegister(a),this.source.push(a+" = "+b+";")},useRegister:function(a){this.context.registers[a]||(this.context.registers[a]=!0,this.context.registers.list.push(a))},pushStack:function(a){return this.source.push(this.nextStack()+" = "+a+";"),"stack"+this.stackSlot},nextStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),"stack"+this.stackSlot},popStack:function(){return"stack"+this.stackSlot--},topStack:function(){return"stack"+this.stackSlot},quotedString:function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r")+'"'}};var f="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),g=c.RESERVED_WORDS={};for(var h=0,i=f.length;h<i;h++)g[f[h]]=!0;c.isValidJavaScriptVariableName=function(a){return!c.RESERVED_WORDS[a]&&/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(a)?!0:!1}}(a.Compiler,a.JavaScriptCompiler),a.precompile=function(b,c){c=c||{};var d=a.parse(b),e=(new a.Compiler).compile(d,c);return(new a.JavaScriptCompiler).compile(e,c)},a.compile=function(b,c){function e(){var d=a.parse(b),e=(new a.Compiler).compile(d,c),f=(new a.JavaScriptCompiler).compile(e,c,undefined,!0);return a.template(f)}c=c||{};var d;return function(a,b){return d||(d=e()),d.call(this,a,b)}},a.VM={template:function(b){var c={escapeExpression:a.Utils.escapeExpression,invokePartial:a.VM.invokePartial,programs:[],program:function(b,c,d){var e=this.programs[b];return d?a.VM.program(c,d):e?e:(e=this.programs[b]=a.VM.program(c),e)},programWithDepth:a.VM.programWithDepth,noop:a.VM.noop};return function(d,e){return e=e||{},b.call(c,a,d,e.helpers,e.partials,e.data)}},programWithDepth:function(a,b,c){var d=Array.prototype.slice.call(arguments,2);return function(c,e){return e=e||{},a.apply(this,[c,e.data||b].concat(d))}},program:function(a,b){return function(c,d){return d=d||{},a(c,d.data||b)}},noop:function(){return""},invokePartial:function(b,c,d,e,f,g){options={helpers:e,partials:f,data:g};if(b===undefined)throw new a.Exception("The partial "+c+" could not be found");if(b instanceof Function)return b(d,options);if(!a.compile)throw new a.Exception("The partial "+c+" could not be compiled when running in runtime-only mode");return f[c]=a.compile(b),f[c](d,options)}},a.template=a.VM.template,a}),define("ui/widgets/Templates",["vendor/Handlebars"],function(a){return{BackgroundPicker:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="modal-header">	<button class="close" data-dismiss="modal">×</button>	<h3>Change Background</h3></div><div class="modal-body">	<div class="pull-left">		<div><h4>Gradient</h4></div>		<div class="gradientPicker">		</div>		<div class="gradientOptions">			<div class="btn-group">	  			<button class="btn">Type</button>	  			<button class="btn dropdown-toggle" data-toggle="dropdown">	    			<span class="caret"></span>	  			</button>	  			<ul class="dropdown-menu" data-option="type">	    			<li><a href="#" data-value="linear">Linear</a></li>	    			<li><a href="#" data-value="radial">Radial</a></li>	  			</ul>			</div>			<div class="btn-group">	  			<button class="btn">Direction</button>	  			<button class="btn dropdown-toggle" data-toggle="dropdown">	    			<span class="caret"></span>	  			</button>	  			<ul class="dropdown-menu" data-option="direction">	    			<li><a href="#" data-value="top">Top</a></li>	    			<li><a href="#" data-value="left">Left</a></li>	    			<li><a href="#" data-value="15deg">15&deg;</a></li>	    			<li><a href="#" data-value="30deg">30&deg;</a></li>	    			<li><a href="#" data-value="45deg">45&deg;</a></li>	    			<li><a href="#" data-value="105deg">105&deg;</a></li>	    			<li><a href="#" data-value="120deg">120&deg;</a></li>	    			<li><a href="#" data-value="135deg">135&deg;</a></li>	  			</ul>			</div>		</div>	</div>	<div class="pull-left bgPreview">		<div><h4>Background Preview</h4></div>		<div class="gradientPreview">		</div>	</div>	<div style="clear: both"></div></div><div class="modal-footer">	<a href="#" class="btn btn-inverse ok">OK</a>	<a href="#" class="btn" data-dismiss="modal">Cancel</a></div>'}),OpenDialog:a.template(function(a,b,c,d,e){function o(a,b){var c="",d;return c+='			<li><a href="#"><span>',d=a,typeof d===k?d=d.call(a,{hash:{}}):d===m&&(d=l.call(a,".",{hash:{}})),c+=n(d)+'</span><button class="close">x</button></a></li>		',c}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression;f+='<div class="modal-header">	<button class="close" data-dismiss="modal">×</button>	<h3>Open</h3></div><div class="modal-body">	<ul class="nav nav-list">		',g=c.fileNames||b.fileNames,h=c.each,i=j.program(1,o,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;return f+='	</ul></div><div class="modal-footer">	<a href="#" class="btn btn-inverse ok">OK</a>	<a href="#" class="btn" data-dismiss="modal">Cancel</a></div>',f}),PictureGrabber:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="modal-header">	<button class="close" data-dismiss="modal">×</button>	<h3>Insert Picture</h3></div><div class="modal-body">	<h4>URL:</h4><input type="text" name="imageUrl"></input>	<h4>Preview:</h4>	<ul class="thumbnails">		<li class="span4">			<div class="thumbnail">				<img src="" class="preview" width="360" height"268"></img>			</div>		</li>	</ul></div><div class="modal-footer">	<a href="#" class="btn btn-primary ok btn-inverse">OK</a>	<a href="#" class="btn" data-dismiss="modal">Cancel</a></div>'}),RawTextImporter:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="modal-header">	<button class="close" data-dismiss="modal">×</button>	<h3>Import/Export Show (from/to JSON)</h3></div><div class="modal-body">	<h4>JSON string</h4>	<textarea style="width: 100%; height: 100%" rows="10"></textarea></div><div class="modal-footer">	<a href="#" class="btn btn-inverse ok">OK</a>	<a href="#" class="btn" data-dismiss="modal">Cancel</a></div>'}),SaveAsDialog:a.template(function(a,b,c,d,e){function o(a,b){var c="",d;return c+='			<li><a href="#"><span>',d=a,typeof d===k?d=d.call(a,{hash:{}}):d===m&&(d=l.call(a,".",{hash:{}})),c+=n(d)+'</span><button class="close">x</button></a></li>		',c}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression;f+='<div class="modal-header">	<button class="close" data-dismiss="modal">×</button>	<h3>Save as...</h3></div><div class="modal-body">	<h4>Name</h4>	<input type="text"></input>	<ul class="nav nav-list">		',g=c.fileNames||b.fileNames,h=c.each,i=j.program(1,o,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;return f+='	</ul></div><div class="modal-footer">	<a href="#" class="btn btn-inverse ok">OK</a>	<a href="#" class="btn" data-dismiss="modal">Cancel</a></div>',f})}}),define("ui/widgets/PictureGrabber",["vendor/backbone","./Templates","common/Throttler"],function(a,b,c){return a.View.extend({className:"pictureGrabber modal",events:{"click .ok":"okClicked","keyup input[name='imageUrl']":"urlChanged","paste input[name='imageUrl']":"urlChanged"},initialize:function(){return this.throttler=new c(200,this)},show:function(a){return this.cb=a,this.$el.modal("show")},okClicked:function(){return this.cb(this.src),this.$el.modal("hide")},urlChanged:function(){return this.throttler.submit(this.loadImage,{rejectionPolicy:"runLast"})},loadImage:function(){return this.img.src=this.$input.val(),this.src=this.img.src},render:function(){return this.$el.html(b.PictureGrabber()),this.$el.modal(),this.$el.modal("hide"),this.img=this.$el.find("img")[0],this.$input=this.$el.find("input[name='imageUrl']"),this.$el},constructor:function(){a.View.prototype.constructor.apply(this,arguments)}})}),define("vendor/keymaster",[],function(){var a={};return function(a){function h(a,b){var c=a.length;while(c--)if(a[c]===b)return c;return-1}function i(a){var b,g,i,j,k;b=a.keyCode;if(b==93||b==224)b=91;if(b in d){d[b]=!0;for(i in f)f[i]==b&&(l[i]=!0);return}if(!l.filter.call(this,a))return;if(!(b in c))return;for(j=0;j<c[b].length;j++){g=c[b][j];if(g.scope==e||g.scope=="all"){k=g.mods.length>0;for(i in d)if(!d[i]&&h(g.mods,+i)>-1||d[i]&&h(g.mods,+i)==-1)k=!1;(g.mods.length==0&&!d[16]&&!d[18]&&!d[17]&&!d[91]||k)&&g.method(a,g)===!1&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation&&a.stopPropagation(),a.cancelBubble&&(a.cancelBubble=!0))}}}function j(a){var b=a.keyCode,c;if(b==93||b==224)b=91;if(b in d){d[b]=!1;for(c in f)f[c]==b&&(l[c]=!1)}}function k(){for(b in d)d[b]=!1;for(b in f)l[b]=!1}function l(a,b,d){var e,h,i,j;d===undefined&&(d=b,b="all"),a=a.replace(/\s/g,""),e=a.split(","),e[e.length-1]==""&&(e[e.length-2]+=",");for(i=0;i<e.length;i++){h=[],a=e[i].split("+");if(a.length>1){h=a.slice(0,a.length-1);for(j=0;j<h.length;j++)h[j]=f[h[j]];a=[a[a.length-1]]}a=a[0],a=g[a]||a.toUpperCase().charCodeAt(0),a in c||(c[a]=[]),c[a].push({shortcut:e[i],scope:b,method:d,key:e[i],mods:h})}}function m(a){var b=(a.target||a.srcElement).tagName;return b!="INPUT"&&b!="SELECT"&&b!="TEXTAREA"}function n(a){e=a||"all"}function o(){return e||"all"}function p(a){var b,d,e;for(b in c){d=c[b];for(e=0;e<d.length;)d[e].scope===a?d.splice(e,1):e++}}function q(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c(window.event)})}var b,c={},d={16:!1,18:!1,17:!1,91:!1},e="all",f={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},g={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(b=1;b<20;b++)f["f"+b]=111+b;for(b in f)l[b]=!1;q(document,"keydown",i),q(document,"keyup",j),q(window,"focus",k),a.key=l,a.key.setScope=n,a.key.getScope=o,a.key.deleteScope=p,a.key.filter=m,typeof module!="undefined"&&(module.exports=key)}(a),a.key}),define("ui/interactions/CutCopyPasteBindings",["vendor/keymaster"],function(a){var b,c;return b=["cut","copy","paste"],c={applyTo:function(c,d){return _.bindAll(c,b),a("ctrl+x, ⌘+x",d,c.cut),a("ctrl+c, ⌘+c",d,c.copy),a("ctrl+v, ⌘+v",d,c.paste)}}}),define("common/Math2",{round:function(a,b){var c;return b!=null||(b=0),c=Math.pow(10,b),Math.round(a*c)/c}}),define("ui/editor/transition_editor/TransitionEditorButtonBarView",["../button_bar/AbstractButtonBarView","common/Math2"],function(a,b){var c;return c={rotateX:function(a){var b;b=parseFloat(a.target.value);if(!isNaN(b))return this.model.changeSlideRotations(b)},rotateY:function(a){var b;b=parseFloat(a.target.value);if(!isNaN(b))return this.model.changeSlideRotations(null,b)},rotateZ:function(a){var b;b=parseFloat(a.target.value);if(!isNaN(b))return this.model.changeSlideRotations(null,null,b)},slideEditor:function(a){return this.$el.trigger("changePerspective",{perspective:"slideEditor"})},preview:function(a){return this.$el.trigger("preview")},lookDownZ:function(a){},lookDownY:function(a){},lookDownX:function(a){}},a.extend({events:function(){return{"keyup *[data-option]":"optionChosen","paste *[data-option]":"optionChosen","click .btn[data-option]":"optionChosen",click:"clicked"}},initialize:function(){return a.prototype.initialize.call(this,c),this.model.on("change:slideRotations",this._slideRotationsChanged,this)},_slideRotationsChanged:function(a,b){return this.partialRender(b)},clicked:function(a){return a.stopPropagation(),!1},partialRender:function(a,b){a||(a=this.model.slideRotations());if(a!=null)return this.updateRotationControls(this.$slideRotCtrls,a)},updateRotationControls:function(a,c){return a.each(function(a,d){var e;e=c[a];if(e==null||isNaN(e))e=0;return $(d).val(b.round(e,2))})},render:function(){return this.$slideRotCtrls=this.$el.find(".slideRotations input"),this.partialRender()}})}),define("model/editor/transition_editor/TransitionEditorButtonBarModel",["vendor/backbone"],function(a){var b,c;return c=180/Math.PI,b={silent:!0},a.Model.extend({initialize:function(){var a;return a=this.get("deck"),a.on("change:activeSlide",this._activeSlideChanged,this),this._lastActive=null,this._activeSlideChanged(a,a.get("activeSlide"))},_activeSlideChanged:function(a,b){this._lastActive!=null&&this._lastActive.off(null,null,this),this._lastActive=b;if(b!=null)return b.on("change:rotateX",this._slideRotationChanged,this),b.on("change:rotateY",this._slideRotationChanged,this),b.on("change:rotateZ",this._slideRotationChanged,this),this._slideRotationChanged(b)},_slideRotationChanged:function(a,b){return this.trigger("change:slideRotations",this,this.slideRotations())},slideRotations:function(){var a;return a=this._lastActive,a!=null?[a.get("rotateX")*c,a.get("rotateY")*c,a.get("rotateZ")*c]:[0,0,0]},changeSlideRotations:function(a,d,e){var f,g;f=this._lastActive;if(f!=null)return g={},a!=null&&(g.rotateX=a/c),d!=null&&(g.rotateY=d/c),e!=null&&(g.rotateZ=e/c),f.set(g,b),f.trigger("rerender")},constructor:function(){a.Model.prototype.constructor.apply(this,arguments)}})}),define("ui/editor/Templates",["vendor/Handlebars"],function(a){return{Component:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="content"></div><span class="topLabel label" data-delta="skewX">Skew X</span><span class="leftLabel label" data-delta="skewY">Skew Y</span><span class="rightLabel label" data-delta="rotate">Rotate</span><span class="scale label" data-delta="scale">Scale</span><span class="close-btn-red-20 removeBtn" title="Remove"></span>'}),Editor:a.template(function(a,b,c,d,e){function o(a,b){var d="",e;return d+='                        <li data-option="',e=c.perspective||a.perspective,typeof e===j?e=e.call(a,{hash:{}}):e===l&&(e=k.call(a,"perspective",{hash:{}})),d+=m(e)+'"><a href="#">',e=c.name||a.name,typeof e===j?e=e.call(a,{hash:{}}):e===l&&(e=k.call(a,"name",{hash:{}})),d+=m(e)+"</a></li>                    ",d}c=c||a.helpers;var f="",g,h,i=this,j="function",k=c.helperMissing,l=void 0,m=this.escapeExpression,n=c.blockHelperMissing;f+='<div class="navbar navbar-fixed-top menuBar">  <div class="btn-inverse temp">    <div class="container">    	<a class="brand" href="#">Strut 0.1</a>     	<ul class="nav">     		<li class="dropdown active">     			<a href="#" class="dropdown-toggle" data-toggle="dropdown">     				File<b class="caret"></b>     			</a>     			<ul class="dropdown-menu">     		 		<li data-option="new"><a href="#">New</a></li>     				<li data-option="open"><a href="#">Open...</a></li><!--     				<li data-option="openRecent"><a href="#">Open Recent...</a></li> -->     				<li data-option="save"><a href="#">Save</a></li>     				<li data-option="saveAs"><a href="#">Save As...</a></li>     			</ul>     		</li>            <li class="dropdown active">                <a href="#" class="dropdown-toggle" data-toggle="dropdown">                    Edit<b class="caret"></b>                </a>                <ul class="dropdown-menu">                    <li data-option="undo"><a href="#">Undo <span class="undoName label"></span></a></li>                    <li data-option="redo"><a href="#">Redo <span class="redoName label"></span></a></li>                    <li data-option="cut"><a href="#">Cut</a></li>                    <li data-option="copy"><a href="#">Copy</a></li>                    <li data-option="paste"><a href="#">Paste</a></li>                </ul>            </li>            <li class="dropdown active">                <a href="#" class="dropdown-toggle" data-toggle="dropdown">                    View<b class="caret"></b>                </a>                <ul class="dropdown-menu">                    ',g=c.perspectives||b.perspectives,h=i.program(1,o,e),h.hash={},h.fn=h,h.inverse=i.noop,typeof g===j?g=g.call(b,h):g=n.call(b,g,h);if(g||g===0)f+=g;return f+='                        <li data-option="preview"><a href="#">Preview Show</a></li>                </ul>            </li>            <li class="dropdown active">                <a href="#" class="dropdown-toggle" data-toggle="dropdown">                    Slideshow<b class="caret"></b>                </a>                <ul class="dropdown-menu">                    <li data-option="exportJSON"><a href="#">Export to JSON</a></li>                    <li data-option="importJSON"><a href="#">Import from JSON</a></li>                    <li class="divider"></li>                    <li data-option="changeBackground"><a href="#">Change Background</a></li>                </ul>            </li>     	</ul>    </div>  </div></div><div class="perspectives-container"></div>',f}),SlideEditor:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="navbar">  <div class="navbar-inner buttonBar">    <div class="container">    	<ul class="nav">            <li style="width: 120px">            	<div class="btn-group iconBtns newSlide">            		<a class="btn btn btn-small menuBarOption" data-option="createSlide" href="#"><i class="icon-plus"></i>Slide</a>            	</div>            </li>            <li class="divider-vertical">            </li>            <li>            	<div class="btn-group normalBtns">            		<a class="btn btn-inverse dropdown-toggle btn-small disabled fontButton fontFamilyBtn" data-toggle="dropdown" title="Choose the font family"><span class="text">Lato</span><span class="caret"></span></a>            		<ul class="dropdown-menu menuBarOption" data-option="fontFamily">            			<li>                                    <a href="#" data-value="\'Lato\', sans-serif">Lato</a>                                    <a href="#" data-value="\'Ubuntu\', sans-serif">Ubuntu</a>                                    <a href="#" data-value="\'Abril Fatface\', cursive">Abril</a>                                    <a href="#" data-value="\'Hammersmith One\', sans-serif">Hammersmith One</a>                                    <a href="#" data-value="\'Fredoka One\', cursive">Fredoka One</a>                                    <a href="#" data-value="\'Gorditas\', cursive">Gorditas</a>                                    <a href="#" data-value="\'Press Start 2P\', cursive">Press Start 2P</a>            			</li>            		</ul>            	</div>            </li>            <li>            	<div class="btn-group normalBtns">            		<a class="btn btn-small btn-inverse dropdown-toggle disabled fontButton fontSizeBtn" data-toggle="dropdown" title="Choose the font size"><span class="text">72</span>            			<span class="caret"></span></a>            		<ul class="dropdown-menu menuBarOption" data-option="fontSize">            			<li>                                    <a href="#" data-value="144">144</a>                                    <a href="#" data-value="96">96</a>                                    <a href="#" data-value="72">72</a>            				<a href="#" data-value="64">64</a>                                    <a href="#" data-value="48">48</a>                                    <a href="#" data-value="36">36</a>                                    <a href="#" data-value="24">24</a>            			</li>            		</ul>            	</div>            </li>            <li>                  <div class="color-chooser normalBtns"><div></div></div>            </li>            <li class="divider-vertical">            </li>            <li>                  <div class="btn-group menuBarOption normalBtns">                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="fontWeight" data-value="bold"><strong>B</strong></a>                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="fontStyle" data-value="italic"><em>I</em></a>                        <a class="btn btn-small btn-inverse underline disabled fontButton" data-option="fontDecoration" data-value="underline">U</a>                  </div>            </li>            <li>                  <div class="btn-group menuBarOption normalBtns">                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="textAlign" data-value="left"><i class="icon-align-left icon-white"></i></a>                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="textAlign" data-value="center"><i class="icon-align-center icon-white"></i></a>                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="textAlign" data-value="right"><i class="icon-align-right icon-white"></i></a>                        <a class="btn btn-small btn-inverse disabled fontButton" data-option="textAlign" data-value="justify"><i class="icon-align-justify icon-white"></i></a>                  </div>            </li>            <li class="divider-vertical">            </li>            <li>                  <div class="btn-group iconBtns">                        <a class="btn menuBarOption" data-option="textBox"><i class="icon-text-width"></i>Text</a>                        <a class="btn btn menuBarOption" data-option="picture"><i class="icon-picture"></i>Image</a>                        <a class="btn btn menuBarOption" data-option="table"><i class="icon-th"></i>Table</a>                        <a class="btn btn menuBarOption" data-option="shapes"><i class="icon-star"></i>Shapes</a>                  </div>            </li>            <li class="divider-vertical">            </li>        </ul>        <ul class="nav pull-right">            <li>                  <div class="btn-group">                        <a class="btn btn-danger transitionEditorBtn" data-option="preview"><span>Preview Show</span></a>                        <a class="btn btn-danger transitionEditorBtn" data-option="transitionEditor"><span>Transition Editor</span><i class="icon-arrow-right"></i></a>                  </div>            </li>        </ul>    </div>  </div></div><div class="mainContent"></div>'}),SlideSnapshot:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<canvas></canvas><span class="close-btn-red-20 removeBtn" title="Remove"></span><span class="badge badge-inverse"></span>'}),TransitionEditor:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="navbar">  <div class="navbar-inner buttonBar">    <div class="container">      <ul class="nav slideRotations">        <li>          <span class="label label-inverse">Rot. X:</span><input type="text" data-option="rotateX"></input>        </li>        <li>          <span class="label label-inverse">Rot. Y:</span><input type="text" data-option="rotateY"></input>        </li>        <li>          <span class="label label-inverse">Rot. Z:</span><input type="text" data-option="rotateZ"></input>        </li>        <li class="divider-vertical">        </li>      </ul>      <ul class="nav cameraSettings">        <li>          <div class="btn-group cameraControls">            <button class="btn"><i class="icon-camera"></i></button>            <a class="btn active" data-option="lookDownZ">Z</a>            <a class="btn" data-option="lookDownY">Y</a>            <a class="btn" data-option="lookDownX">X</a>          </div>        </li>      </ul>    	<ul class="nav pull-right">    		<li>    			<div class="btn-group">                        <a class="btn btn-danger menuBarOption" data-option="slideEditor"><i class="icon-arrow-left"></i>Back</a>                        <a class="btn btn-danger menuBarOption" data-option="preview">Preview Show<i class="icon-arrow-right"></i></a>                  </div>    		</li>    	</ul>   	</div>  </div></div><div class="transitionSlides"></div>'}),TransitionSlideSnapshot:a.template(function(a,b,c,d,e){c=c||a.helpers;var f=this;return'<div class="content"><canvas></canvas></div><span class="topLabel label" data-delta="rotateY">Rotate Y</span><span class="leftLabel label" data-delta="rotateX">Rotate X</span><span class="rightLabel label" data-delta="rotateZ">Rotate Z</span><div class="spinners"><input type="text" class="smartspinner label" data-name="depth"/><input type="text" class="smartspinner label" data-name="scale"/></div><span class="badge badge-inverse"></span>'})}}),define("ui/impress_renderer/Templates",["vendor/Handlebars"],function(a){return{ComponentContainer:a.template(function(a,b,c,d,e){function o(a,b){var d="",e;return d+="rotate(",e=c.rotate||a.rotate,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"rotate",{hash:{}})),d+=n(e)+"rad)",d}function p(a,b){var d="",e;return d+="skewX(",e=c.skewX||a.skewX,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewX",{hash:{}})),d+=n(e)+"rad)",d}function q(a,b){var d="",e;return d+="skewY(",e=c.skewY||a.skewY,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewY",{hash:{}})),d+=n(e)+"rad)",d}function r(a,b){var d="",e;return d+="scale(",e=c.scale||a.scale,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"scale",{hash:{}})),d+=n(e)+")",d}function s(a,b){var d="",e;return d+="rotate(",e=c.rotate||a.rotate,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"rotate",{hash:{}})),d+=n(e)+"rad)",d}function t(a,b){var d="",e;return d+="skewX(",e=c.skewX||a.skewX,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewX",{hash:{}})),d+=n(e)+"rad)",d}function u(a,b){var d="",e;return d+="skewY(",e=c.skewY||a.skewY,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewY",{hash:{}})),d+=n(e)+"rad)",d}function v(a,b){var d="",e;return d+="scale(",e=c.scale||a.scale,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"scale",{hash:{}})),d+=n(e)+")",d}function w(a,b){var d="",e;return d+="rotate(",e=c.rotate||a.rotate,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"rotate",{hash:{}})),d+=n(e)+"rad)",d}function x(a,b){var d="",e;return d+="skewX(",e=c.skewX||a.skewX,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewX",{hash:{}})),d+=n(e)+"rad)",d}function y(a,b){var d="",e;return d+="skewY(",e=c.skewY||a.skewY,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"skewY",{hash:{}})),d+=n(e)+"rad)",d}function z(a,b){var d="",e;return d+="scale(",e=c.scale||a.scale,typeof e===k?e=e.call(a,{hash:{}}):e===m&&(e=l.call(a,"scale",{hash:{}})),d+=n(e)+")",d}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.helperMissing,m=void 0,n=this.escapeExpression;f+='<div style="position: absolute; top: ',g=c.y||b.y,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"y",{hash:{}})),f+=n(g)+"px; left: ",g=c.x||b.x,typeof g===k?g=g.call(b,{hash:{}}):g===m&&(g=l.call(b,"x",{hash:{}})),f+=n(g)+"px;-webkit-transform: ",g=c.rotate||b.rotate,h=c["if"],i=j.program(1,o,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewX||b.skewX,h=c["if"],i=j.program(3,p,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewY||b.skewY,h=c["if"],i=j.program(5,q,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.scale||b.scale,h=c["if"],i=j.program(7,r,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=";-moz-transform: ",g=c.rotate||b.rotate,h=c["if"],i=j.program(9,s,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewX||b.skewX,h=c["if"],i=j.program(11,t,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewY||b.skewY,h=c["if"],i=j.program(13,u,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.scale||b.scale,h=c["if"],i=j.program(15,v,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=";transform: ",g=c.rotate||b.rotate,h=c["if"],i=j.program(17,w,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewX||b.skewX,h=c["if"],i=j.program(19,x,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.skewY||b.skewY,h=c["if"],i=j.program(21,y,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;f+=" ",g=c.scale||b.scale,h=c["if"],i=j.program(23,z,e),i.hash={},i.fn=i,i.inverse=j.noop,g=h.call(b,g,i);if(g||g===0)f+=g;return f+='">',f}),Image:a.template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h=this,i="function",j=c.helperMissing,k=void 0,l=this.escapeExpression;g=b,g=h.invokePartial(d.ComponentContainer,"ComponentContainer",g,c,d);if(g||g===0)f+=g;return f+='<img src="',g=c.src||b.src,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"src",{hash:{}})),f+=l(g)+'"></img></div>',f}),ImpressTemplate:a.template(function(a,b,c,d,e){function p(a,b){var c="";return c}function q(a,b){var d="",e;d+="",e=c.attributes||a.attributes,i=j.program(4,r,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof e===k?e=e.call(a,i):e=l.call(a,e,i);if(e||e===0)d+=e;return d+="</div>",d}function r(a,b){var d="",e,f;d+='<div class="step" data-x="',e=c.x||a.x,f=c.scaleX||a.scaleX,i=j.program(5,s,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;d+='" data-y="',e=c.y||a.y,f=c.scaleY||a.scaleY,i=j.program(7,t,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;d+='" ',e=c.rotateX||a.rotateX,f=c["if"],i=j.program(9,u,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+="  ",e=c.rotateY||a.rotateY,f=c["if"],i=j.program(12,w,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+=" ",e=c.rotateZ||a.rotateZ,f=c["if"],i=j.program(15,y,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+=" ",e=c.z||a.z,f=c["if"],i=j.program(18,A,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+=" ",e=c.impScale||a.impScale,f=c["if"],i=j.program(20,B,b),i.hash={},i.fn=i,i.inverse=j.noop,e=f.call(a,e,i);if(e||e===0)d+=e;d+='><div style="width: 1024px; height: 768px">',e=c.components||a.components,i=j.program(22,C,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof e===k?e=e.call(a,i):e=l.call(a,e,i);if(e||e===0)d+=e;return d+="</div>",d}function s(a,b){var c="";return c}function t(a,b){var c="";return c}function u(a,b){var d="",e,f;d+='data-rotate-x="',e=c.rotateX||a.rotateX,f=c.toDeg||a.toDeg,i=j.program(10,v,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;return d+='"',d}function v(a,b){var c="";return c}function w(a,b){var d="",e,f;d+='data-rotate-y="',e=c.rotateY||a.rotateY,f=c.toDeg||a.toDeg,i=j.program(13,x,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;return d+='"',d}function x(a,b){var c="";return c}function y(a,b){var d="",e,f;d+='data-rotate-z="',e=c.rotateZ||a.rotateZ,f=c.toDeg||a.toDeg,i=j.program(16,z,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;return d+='"',d}function z(a,b){var c="";return c}function A(a,b){var d="",e;return d+='data-z="',e=c.z||a.z,typeof e===k?e=e.call(a,{hash:{}}):e===n&&(e=m.call(a,"z",{hash:{}})),d+=o(e)+'"',d}function B(a,b){var d="",e;return d+='data-scale="',e=c.impScale||a.impScale,typeof e===k?e=e.call(a,{hash:{}}):e===n&&(e=m.call(a,"impScale",{hash:{}})),d+=o(e)+'"',d}function C(a,b){var d="",e,f;d+="",e=a,f=c.renderComponent||a.renderComponent,i=j.program(23,D,b),i.hash={},i.fn=i,i.inverse=j.noop,typeof f===k?e=f.call(a,e,i):e=l.call(a,f,e,i);if(e||e===0)d+=e;return d+="",d}function D(a,b){var c="";return c}c=c||a.helpers;var f="",g,h,i,j=this,k="function",l=c.blockHelperMissing,m=c.helperMissing,n=void 0,o=this.escapeExpression;f+='<!doctype html><html lang="en"><head> <meta charset="utf-8" />    <meta name="viewport" content="width=1024" />    <meta name="apple-mobile-web-app-capable" content="yes" />    <title>Deck Title</title>        <meta name="description" content="TODO" />    <meta name="author" content="TODO" />    <link href="http://tantaman.github.com/Showoff/client/web/preview_export/css/main.css" rel="stylesheet" />        <link rel="shortcut icon" href="favicon.png" />    <link rel="apple-touch-icon" href="apple-touch-icon.png" />    <link href=\'http://fonts.googleapis.com/css?family=Lato:400,700,700italic|Ubuntu:400,700|Abril+Fatface|Hammersmith+One|Fredoka+One|Gorditas|Press+Start+2P\' rel=\'stylesheet\' type=\'text/css\'></head><body class="impress-not-supported" style="',g=c.background||b.background,g=g===null||g===undefined||g===!1?g:g.styles,h=c.extractBG||b.extractBG,i=j.program(1,p,e),i.hash={},i.fn=i,i.inverse=j.noop,typeof h===k?g=h.call(b,g,i):g=l.call(b,h,g,i);if(g||g===0)f+=g;f+='"><div class="fallback-message">    <p>Your browser <b>doesn\'t support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p></div><div id="impress">',g=c.slides||b.slides,g=g===null||g===undefined||g===!1?g:g.models,i=j.program(3,q,e),i.hash={},i.fn=i,i.inverse=j.noop,typeof g===k?g=g.call(b,i):g=l.call(b,g,i);if(g||g===0)f+=g;return f+='<div class="hint">    <p>Use a spacebar or arrow keys to navigate</p></div><script>if ("ontouchstart" in document.documentElement) {     document.querySelector(".hint").innerHTML = "<p>Tap on the left or right to navigate</p>";}</script><script src="http://tantaman.github.com/Showoff/client/web/preview_export/scripts/impress.js"></script><script>impress().init();</script></body></html>',f}),TextBox:a.template(function(a,b,c,d,e){c=c||a.helpers,d=d||a.partials;var f="",g,h=this,i="function",j=c.helperMissing,k=void 0,l=this.escapeExpression;g=b,g=h.invokePartial(d.ComponentContainer,"ComponentContainer",g,c,d);if(g||g===0)f+=g;return f+='<div style="font-family: ',g=c.family||b.family,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"family",{hash:{}})),f+=l(g)+"; font-size: ",g=c.size||b.size,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"size",{hash:{}})),f+=l(g)+"px;			font-weight: ",g=c.weight||b.weight,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"weight",{hash:{}})),f+=l(g)+"; font-style: ",g=c.style||b.style,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"style",{hash:{}})),f+=l(g)+"; color: #",g=c.color||b.color,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"color",{hash:{}})),f+=l(g)+";			text-decoration: ",g=c.decoration||b.decoration,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"decoration",{hash:{}})),f+=l(g)+"; text-align: ",g=c.align||b.align,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"align",{hash:{}})),f+=l(g)+'">',g=c.text||b.text,typeof g===i?g=g.call(b,{hash:{}}):g===k&&(g=j.call(b,"text",{hash:{}})),f+=l(g)+"</div></div>",f})}}),define("ui/impress_renderer/ImpressRenderer",["vendor/Handlebars","./Templates"],function(a,b){var c;return c=function(){function c(){var c=this;a.registerHelper("renderComponent",function(d){var e;e="";switch(d.get("type")){case"ImageModel":e=b.Image(d.attributes);break;case"TextBox":e=b.TextBox(c.convertTextBoxData(d.attributes))}return new a.SafeString(e)}),a.registerHelper("scaleX",function(a){return a*slideConfig.size.width/150}),a.registerHelper("scaleY",function(a){return a*slideConfig.size.width/150}),a.registerHelper("toDeg",function(a){return a*180/Math.PI}),a.registerHelper("extractBG",function(a){var b,c,d,e,f,g;if(a!=null&&a.length>0){d="",e=a[0],b=["-moz-","-webkit-","-o-","-ms-",""];for(f=0,g=b.length;f<g;f++)c=b[f],d+="background-image: "+c+e+"; ";return d}return""}),a.registerPartial("ComponentContainer",b.ComponentContainer)}return c.name="ImpressRenderer",c.prototype.render=function(a){var c,d,e,f,g=this;return f=a.slides,d=6,c=0,f.each(function(a){var b;return b=a.get("x"),b==null&&(a.set("x",c*160+30),a.set("y",(c/d|0)*160+80)),++c}),e=b.ImpressTemplate(a),e},c.prototype.convertTextBoxData=function(b){var c;return c=_.extend({},b),c.text=new a.SafeString(b.text),c},c}(),new c}),define("ui/widgets/RawTextImporter",["vendor/backbone","./Templates"],function(a,b){return a.View.extend({className:"rawTextImporter modal",events:{"click .ok":"okClicked"},initialize:function(){},show:function(a,b){return this.cb=a,b!=null&&this.$txtArea.val(b),this.$el.modal("show")},okClicked:function(){return this.cb!=null&&this.cb(this.$txtArea.val()),this.$el.modal("hide")},render:function(){return this.$el.html(b.RawTextImporter()),this.$el.modal(),this.$el.modal("hide"),this.$txtArea=this.$el.find("textarea"),this.$el}})}),define("storage/FileStorage",[],function(){var a;return a=function(){function a(){this.storageImpl=localStorage}return a.name="FileStorage",a.prototype.fileNames=function(){var a,b,c;c=this.storageImpl.length,b=0,a=[];while(b<c)a.push(localStorage.key(b)),++b;return a},a.prototype.remove=function(a){return this.storageImpl.removeItem(a)},a.prototype.save=function(a,b){return this.storageImpl.setItem(a,JSON.stringify(b))},a.prototype.open=function(a){return JSON.parse(this.storageImpl.getItem(a))},a}(),new a}),define("css",[],function(){function a(a){if(typeof document=="undefined")return;var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href="scripts/"+a,document.getElementsByTagName("head")[0].appendChild(b)}return{load:function(b,c,d,e){a(b),d(null)}}}),define("ui/editor/SlideSnapshot",["vendor/backbone","./Templates","css!./res/css/SlideSnapshot.css","./raster/SlideDrawer"],function(a,b,c,d){return a.View.extend({className:"slideSnapshot",events:{click:"clicked","click .removeBtn":"removeClicked"},initialize:function(){return this.model.on("change:active",this._activated,this),this.model.on("dispose",this._modelDisposed,this),this.options.deck.on("change:background",this._updateBG,this)},clicked:function(){return this.model.set("selected",!0),this.model.set("active",!0)},removeClicked:function(a){return this.trigger("removeClicked",this),a.stopPropagation()},remove:function(){return this.slideDrawer.dispose(),this.off(),this.$el.data("jsView",null),this.model.off(null,null,this),this.options.deck.off(null,null,this),a.View.prototype.remove.apply(this,arguments)},_activated:function(a,b){return b?this.$el.addClass("active"):this.$el.removeClass("active")},_modelDisposed:function(){return this.model.off(null,null,this),this.remove()},_updateBG:function(){var a;a=this.options.deck.get("background"),console.log("BG UPDATED");if(a!=null)return this.$el.css("background-image",a.styles[0]),this.$el.css("background-image",a.styles[1])},render:function(){var a;return this.slideDrawer!=null&&this.slideDrawer.dispose(),this.$el.html(b.SlideSnapshot(this.model.attributes)),a=this.$el.find("canvas")[0].getContext("2d"),this.slideDrawer=new d(this.model,a),this.slideDrawer.repaint(),this.model.get("active")&&this.$el.addClass("active"),this.$el.data("jsView",this),this._updateBG(),this.$el}})}),define("ui/editor/SlidePreviewPanel",["vendor/backbone","./SlideSnapshot","vendor/keymaster","ui/interactions/CutCopyPasteBindings","model/system/Clipboard","./SlideCopyPaste","css!./res/css/SlidePreviewPanel.css"],function(a,b,c,d,e,f,g){return a.View.extend({className:"slidePreviewPanel",events:{sortstop:"sortstop",click:"clicked"},initialize:function(){var a;return a=this.model.get("slides"),a.on("add",this._slideCreated,this),a.on("reset",this._slidesReset,this),_.extend(this,f),d.applyTo(this,"slidePreviewPanel"),this._clipboard=new e},_slideCreated:function(a){var c;return c=new b({model:a,deck:this.model}),c.on("removeClicked",this.slideRemoveClicked,this),this.$el.append(c.render())},_slidesReset:function(a){var b=this;return a.each(function(a){return b._slideCreated(a)})},_slideRemoved:function(a,b,c){return this.snapshots[c.index].remove(),this.snapshots.splice(c.index,1)},slideRemoveClicked:function(a){return this.model.removeSlide(a.model)},render:function(){var a,b=this;return a=this.model.get("slides"),a!=null&&a.each(function(a){return b._slideCreated(a)}),this.$el.sortable(),this.$el},sortstop:function(a,b){var c=this;return this.$el.children().each(function(a,b){return $(b).data("jsView").model.set("num",a)}),this.model.get("slides").sort({silent:!0})},clicked:function(){if(c.getScope()!=="slidePreviewPanel")return c.setScope("slidePreviewPanel")},remove:function(){return a.View.prototype.remove.apply(this,arguments),this.dispose()},dispose:function(){return this.snapshots.forEach(function(a){return a.dispose()})}})}),define("ui/editor/components/ComponentView",["vendor/backbone","ui/widgets/DeltaDragControl","../Templates","css!../res/css/ComponentView.css"],function(a,b,c,d){return a.View.extend({transforms:["skewX","skewY","rotate","scale"],className:"component",events:function(){return{mousedown:"mousedown",click:"clicked","click .removeBtn":"removeClicked","deltadrag span[data-delta='skewX']":"skewX","deltadrag span[data-delta='skewY']":"skewY","deltadrag span[data-delta='rotate']":"rotate","deltadrag span[data-delta='scale']":"scale","deltadragStart span[data-delta='skewX']":"skewXStart","deltadragStart span[data-delta='skewY']":"skewYStart","deltadragStart span[data-delta='rotate']":"rotateStart","deltadragStart span[data-delta='scale']":"scaleStart"}},initialize:function(){return this._dragging=!1,this.allowDragging=!0,this.model.on("change:selected",this._selectionChanged,this),this.model.on("change:color",this._colorChanged,this),this.model.on("unrender",this._unrender,this),this._mouseup=this.stopdrag.bind(this),this._mousemove=this.mousemove.bind(this),$(document).bind("mouseup",this._mouseup),$(document).bind("mousemove",this._mousemove),this._deltaDrags=[],this.model.on("rerender",this._setUpdatedTransform,this)},_selectionChanged:function(a,b){return b?this.$el.addClass("selected"):this.$el.removeClass("selected")},_colorChanged:function(a,b){return this.$el.css("color","#"+b)},clicked:function(a){return this.$el.trigger("focused"),a.stopPropagation(),!1},removeClicked:function(a){return a.stopPropagation(),this.remove()},skewX:function(a,b){return this.model.set("skewX",this._initialSkewX+Math.atan2(b.dx,22)),this._setUpdatedTransform()},skewXStart:function(){return this._initialSkewX=this.model.get("skewX")||0},skewY:function(a,b){return this.model.set("skewY",this._initialSkewY+Math.atan2(b.dy,22)),this._setUpdatedTransform()},skewYStart:function(){return this._initialSkewY=this.model.get("skewY")||0},rotate:function(a,b){var c;return c=Math.atan2(b.y-this._origin.y,b.x-this._origin.x),this.model.set("rotate",this._initialRotate+c-this._rotOffset),this._setUpdatedTransform()},rotateStart:function(a,b){return this.updateOrigin(),this._rotOffset=this._calcRot(b),this._initialRotate=this.model.get("rotate")||0},updateOrigin:function(){return this._origin={x:this.$el.width()/2+this.model.get("x"),y:this.$el.height()/2+this.model.get("y")}},_calcRot:function(a){return Math.atan2(a.y-this._origin.y,a.x-this._origin.x)},scale:function(a,b){var c,d,e,f,g;return d=this.$content.width(),c=this.$content.height(),f=d+b.dx,e=c+b.dy,g=f*e/(d*c)*this._initialScale,this.model.set("scale",g),this._setUpdatedTransform()},scaleStart:function(){return this._initialScale=this.model.get("scale")||1},_setUpdatedTransform:function(){var a,b;return b=this.buildTransformString(),a={transform:b},a[window.browserPrefix+"transform"]=b,this.$content.css(a)},buildTransformString:function(){var a,b=this;return a="",this.transforms.forEach(function(c){var d;d=b.model.get(c);if(d)return c==="scale"?a+=c+"("+d+") ":a+=c+"("+d+"rad) "}),a},mousedown:function(a){return this.model.set("selected",!0),this.$el.css("zIndex",zTracker.next()),this._dragging=!0,this._prevPos={x:a.pageX,y:a.pageY}},render:function(){var a,c=this;return this.$el.html(this.__getTemplate()(this.model.attributes)),this.$el.find("span[data-delta]").each(function(a,d){var e;return e=new b($(d),!0),c._deltaDrags.push(e)}),this.$content=this.$el.find(".content"),this._setUpdatedTransform(),a=this.model.get("scale"),this._selectionChanged(this.model,this.model.get("selected")),this.$el},_fixScaling:function(a){var b,c,d,e,f;return e=this.$el.position(),f=this.$el.width()*a,d=this.$el.height()*a,c=f-this.$el.width(),b=d-this.$el.height(),this.$el.css({width:f,height:d,left:e.left-c/2,top:e.top-b/2})},__getTemplate:function(){return c.Component},_unrender:function(){return this.remove(!0)},remove:function(b){var c,d,e,f;a.View.prototype.remove.call(this),f=this._deltaDrags;for(e in f)d=f[e],d.dispose();return b?this.model.off(null,null,this):(this.model.dispose(),this.model.off(null,null,this)),c=$(document),c.unbind("mouseup",this._mouseup),c.unbind("mousemove",this._mousemove)},mousemove:function(a){var b,c,d,e,f,g;if(this._dragging&&this.allowDragging)return f=this.model.get("x"),g=this.model.get("y"),b=a.pageX-this._prevPos.x,c=a.pageY-this._prevPos.y,d=f+b,e=g+c,this.model.set("x",d),this.model.set("y",e),this.$el.css({left:d,top:e}),this._prevPos.x=a.pageX,this._prevPos.y=a.pageY},stopdrag:function(){return this._dragging=!1,!0},constructor:function(){a.View.prototype.constructor.apply(this,arguments)}})}),define("ui/editor/components/ImageView",["./ComponentView"],function(a){return a.extend({className:"component imageView",tagName:"div",initialize:function(){return a.prototype.initialize.apply(this,arguments)},render:function(){var b;return a.prototype.render.call(this),b=$("<img src="+this.model.get("src")+"></img>"),b.bind("dragstart",function(a){return a.preventDefault(),!1}),this.$el.find(".content").append(b),this.$el.css({top:this.model.get("y"),left:this.model.get("x")}),this.$el}})}),define("ui/editor/components/TextBoxView",["./ComponentView","../Templates"],function(a,b){var c;return c=["family","size","weight","style","color","decoration","align"],a.extend({className:"component textBox",tagName:"div",events:function(){var b,c;return c=a.prototype.events.call(this),b={dblclick:"dblclicked",editComplete:"editCompleted"},_.extend(c,b)},initialize:function(){var b,d,e,f;a.prototype.initialize.apply(this,arguments),f=[];for(d=0,e=c.length;d<e;d++)b=c[d],f.push(this.model.on("change:"+b,this._styleChanged,this));return f},dblclicked:function(a){return this.$el.addClass("editable"),this.$el.find(".content").attr("contenteditable",!0),this.allowDragging=!1,this.editing=!0},editCompleted:function(){var a;return a=this.$textEl.html(),this.editing=!1,a===""?this.remove():(console.log("ALLOWING DRAGGING"),this.model.set("text",a),this.$el.find(".content").attr("contenteditable",!1),this.allowDragging=!0)},_styleChanged:function(a,b,c){var d,e,f,g;f=c.changes,g=[];for(d in f)e=f[d],e?(d==="decoration"||d==="align"?(console.log("DECORATION CHANGE"),d="text"+d.substring(0,1).toUpperCase()+d.substr(1)):d!=="color"&&(d="font"+d.substr(0,1).toUpperCase()+d.substr(1)),g.push(this.$el.css(d,b))):g.push(void 0);return g},render:function(){return a.prototype.render.call(this),this.$textEl=this.$el.find(".content"),this.$textEl.html(this.model.get("text")),this.$el.css({fontFamily:this.model.get("family"),fontSize:this.model.get("size"),fontWeight:this.model.get("weight"),fontStyle:this.model.get("style"),color:"#"+this.model.get("color"),top:this.model.get("y"),left:this.model.get("x"),textDecoration:this.model.get("decoration"),textAlign:this.model.get("align")}),this.$el},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("ui/editor/components/ComponentViewFactory",["./ImageView","./TableView","./TextBoxView"],function(a,b,c){var d;return d={createView:function(d){var e;e=d.get("type");switch(e){case"TextBox":return new c({model:d});case"ImageModel":return new a({model:d});case"Table":return new b({model:d})}}}}),define("ui/editor/OperatingTable",["vendor/backbone","./Templates","./components/ComponentViewFactory","vendor/keymaster","ui/interactions/CutCopyPasteBindings","model/system/Clipboard","css!./res/css/OperatingTable.css"],function(a,b,c,d,e,f,g){return a.View.extend({className:"operatingTable",events:{click:"clicked",focused:"_focus"},initialize:function(){return e.applyTo(this,"operatingTable"),this._clipboard=new f},setModel:function(a){var b;return b=this.model,this.model!=null&&this.model.off(null,null,this),this.model=a,this.model!=null&&this.model.on("change:components.add",this._componentAdded,this),this.render(b)},clicked:function(a){return this.model!=null&&(this.model.get("components").forEach(function(a){if(a.get("selected"))return a.set("selected",!1)}),this.$el.find(".editable").removeClass("editable").attr("contenteditable",!1).trigger("editComplete")),this._focus()},cut:function(){var a;a=this.model.lastSelection;if(a!=null)return this._clipboard.set("item",a),this.model.remove(a),a.set("selected",!1),!1},copy:function(){var a,b;a=this.model.lastSelection;if(a!=null)return b=a.clone(),b.set("x",a.get("x")+25),b.set("selected",!1),this._clipboard.set("item",b),!1},paste:function(){var a;return this.$el.find(".editable").length!==0?!0:(a=this._clipboard.get("item"),a!=null&&this.model.add(a.clone()),!1)},_focus:function(){if(d.getScope()!=="operatingTable")return d.setScope("operatingTable")},_componentAdded:function(a,b){var d;return d=c.createView(b),this.$el.append(d.render())},render:function(a){var b,d=this;return a!=null&&a.trigger("unrender",!0),this.model!=null&&(b=this.model.get("components"),b.forEach(function(a){var b;return b=c.createView(a),d.$el.append(b.render())})),this.$el}})}),define("ui/editor/SlideEditor",["vendor/backbone","./Templates","./SlidePreviewPanel","./OperatingTable","common/EventEmitter","css!./res/css/SlideEditor.css","./button_bar/ButtonBarView","ui/widgets/PictureGrabber","vendor/keymaster"],function(a,b,c,d,e,f,g,h,i){return a.View.extend({className:"slideEditor",initialize:function(){var a=this;return this.name="Slide Editor",$(window).resize(function(){return a.resized()}),this.operatingTable=new d,this.slidePreviewPanel=new c({model:this.model}),this.model.on("change:activeSlide",this._activeSlideChanged,this)},show:function(){this.hidden=!1,this.$el.removeClass("disp-none"),i.setScope("slidePreviewPanel");if(this.hiddenActiveChange!=null)return this.operatingTable.setModel(this.hiddenActiveChange),this.hiddenActiveChange=null},cut:function(){var a;return a=this[i.getScope()],a!=null&&a.cut(),!0},copy:function(){var a;return a=this[i.getScope()],a!=null&&a.copy(),!0},paste:function(){var a;return a=this[i.getScope()],a!=null&&a.paste(),!0},backgroundChanged:function(a){var b,c,d,e,f;e=a.styles,f=[];for(c=0,d=e.length;c<d;c++)b=e[c],f.push(this.$operatingTable.css("background-image",b));return f},hide:function(){return this.hidden=!0,this.$el.addClass("disp-none")},_activeSlideChanged:function(a,b){return this.hidden?this.hiddenActiveChange=b:this.operatingTable.setModel(b)},render:function(){var a,c,d;return this.$el.html(b.SlideEditor(this.model)),this.$el.find(".dropdown-toggle").dropdown(),a=this.$el.find("a[title]"),a.tooltip({placement:"bottom",delay:{show:1e3,hide:100}}).click(function(){return a.tooltip("hide")}),c=this.$el.find(".mainContent"),this.$slidePreviewPanel=this.slidePreviewPanel.render(),this.$operatingTable=this.operatingTable.render(),c.append(this.$slidePreviewPanel),c.append(this.$operatingTable),this.resized(),this._buttonBar!=null&&this._buttonBar.dispose(),d=new h,this.$el.append(d.render()),this._buttonBar=new g({el:this.$el.find(".buttonBar"),deck:this.model,pictureGrabber:d}),this._buttonBar.render(),this.$el},resized:function(){if(this.$operatingTable)return this.$slidePreviewPanel.css("height",window.innerHeight-80),this.$operatingTable.css({height:window.innerHeight-80})}})}),define("ui/editor/components/ThreeDRotableComponentView",["./ComponentView","../Templates"],function(a){var b;return b=Math.PI*2,a.extend({transforms:["rotateX","rotateY","rotateZ","scale"],events:function(){return{mousedown:"mousedown",click:"clicked","deltadrag span[data-delta='rotateX']":"rotateX","deltadrag span[data-delta='rotateY']":"rotateY","deltadrag span[data-delta='rotateZ']":"rotateZ","deltadragStart span[data-delta='rotateX']":"rotateXStart","deltadragStart span[data-delta='rotateY']":"rotateYStart","deltadragStart span[data-delta='rotateZ']":"rotateZStart"}},initialize:function(){return a.prototype.initialize.apply(this,arguments)},rotateX:function(a,c){var d;return d=c.dy*.02%b,this.model.set("rotateX",this._initialRotX+d),this._setUpdatedTransform()},rotateY:function(a,c){var d;return d=c.dx*.02%b,this.model.set("rotateY",this._initialRotY+d),this._setUpdatedTransform()},rotateZ:function(a,b){var c;return c=this._calcRot(b),this.model.set("rotateZ",this._initialRotZ+c-this._rotZOffset),this._setUpdatedTransform()},rotateXStart:function(a,b){return this.updateOrigin(),this._rotXOffset=this._calcRot(b),this._initialRotX=this.model.get("rotateX")||0},rotateYStart:function(a,b){return this.updateOrigin(),this._rotYOffset=this._calcRot(b),this._initialRotY=this.model.get("rotateY")||0},rotateZStart:function(a,b){return this.updateOrigin(),this._rotZOffset=this._calcRot(b),this._initialRotZ=this.model.get("rotateZ")||0},__getTemplate:function(){return Templates.ThreeDRotableComponentView},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("ui/editor/transition_editor/TransitionSlideSnapshot",["../components/ThreeDRotableComponentView","../Templates","../raster/SlideDrawer","css!../res/css/TransitionSlideSnapshot.css"],function(a,b,c,d){return a.extend({className:"component transitionSlideSnapshot",events:function(){var b;return b=a.prototype.events(),_.extend(b,{click:"clicked"})},initialize:function(){return a.prototype.initialize.apply(this,arguments)},remove:function(){return a.prototype.remove.call(this,!0),this.slideDrawer!=null&&this.slideDrawer.dispose(),this.model.set("selected",!1)},clicked:function(){return a.prototype.clicked.apply(this,arguments),this.model.set("active",!0)},render:function(){var b,d=this;return a.prototype.render.apply(this,arguments),this.slideDrawer!=null&&this.slideDrawer.dispose(),b=this.$el.find("canvas")[0].getContext("2d"),this.slideDrawer=new c(this.model,b),this.slideDrawer.repaint(),this.$el.css({left:this.model.get("x"),top:this.model.get("y")}),this.$el.find(".smartspinner[data-name='depth']").spinit({callback:function(a){return d.model.set("z",-1*a)},mask:"Depth",height:22,width:45,min:-9e3,max:9e3,stepInc:125,initValue:this.model.get("z")}),this.$el.find(".smartspinner[data-name='scale']").spinit({callback:function(a){return d.model.set("impScale",a)},mask:"Scale",min:1,max:10,height:22,width:45,initValue:this.model.get("impScale")}),this.$el},__getTemplate:function(){return b.TransitionSlideSnapshot},constructor:function(){a.prototype.constructor.apply(this,arguments)}})}),define("ui/editor/transition_editor/TransitionEditor",["vendor/backbone","./TransitionSlideSnapshot","../Templates","./TransitionEditorButtonBarView","model/editor/transition_editor/TransitionEditorButtonBarModel","vendor/keymaster","ui/interactions/CutCopyPasteBindings","../SlideCopyPaste","model/system/Clipboard","css!../res/css/TransitionEditor.css"],function(a,b,c,d,e,f,g,h,i,j){return a.View.extend({className:"transitionEditor",events:{click:"clicked"},scale:window.slideConfig.size.width/150,initialize:function(){return this.name="Transition Editor",this._snapshots=[],this._clipboard=new i,_.extend(this,h),g.applyTo(this,"transitionEditor")},show:function(){return this.hidden=!1,this.$el.removeClass("disp-none"),f.setScope("transitionEditor"),this._partialRender()},resized:function(){},hide:function(){return this.hidden=!0,this._disposeOldView(),this.$el.addClass("disp-none")},clicked:function(){return this.model.get("slides").forEach(function(a){if(a.get("selected"))return a.set("selected",!1)})},backgroundChanged:function(a){},_disposeOldView:function(){return this._snapshots.forEach(function(a){return a.remove()}),this._snapshots=[]},render:function(){return this.$el.html(c.TransitionEditor()),this.buttonBarView=new d({model:new e({deck:this.model}),el:this.$el.find(".navbar")}),this.buttonBarView.render(),this._partialRender(),this.$el},_partialRender:function(){var a,c,d,e,f=this;return this.buttonBarView.partialRender(),a=this.$el.find(".transitionSlides"),a.html(""),e=this.model.get("slides"),d=6,c=0,e.each(function(e){var g,h;return h=e.get("x"),h==null&&(e.set("x",c*160+30),e.set("y",(c/d|0)*160+80)),++c,g=new b({model:e}),f._snapshots.push(g),a.append(g.render())})}})}),define("ui/widgets/OpenDialog",["vendor/backbone","./Templates","storage/FileStorage","css!./res/css/OpenDialog.css"],function(a,b,c,d){return a.View.extend({className:"openDialog modal",events:function(){return{"click .ok":"okClicked","click li > a > span":"fileClicked","click li > a > button":"deleteClicked"}},initialize:function(){},show:function(a,b){return this._renderPartial(),this.cb=a,this.$el.modal("show")},okClicked:function(){return this.cb!=null&&this.cb(this.$el.find(".active span").text()),this.$el.modal("hide")},fileClicked:function(a){return this.$el.find(".active").removeClass("active"),$(a.currentTarget).parent().parent().addClass("active")},deleteClicked:function(a){var b,d;return b=$(a.currentTarget),d=b.siblings("span").text(),c.remove(d),b.parent().parent().remove()},_renderPartial:function(){return this.$el.html(this.__template()({fileNames:c.fileNames()}))},__template:function(){return b.OpenDialog},render:function(){return this._renderPartial(),this.$el.modal(),this.$el.modal("hide"),this.$el}})}),define("ui/widgets/SaveAsDialog",["vendor/backbone","./Templates","./OpenDialog"],function(a,b,c){return c.extend({initialize:function(){return c.prototype.initialize.apply(this,arguments)},fileClicked:function(a){return c.prototype.fileClicked.call(this,a),this.$nameInput.val($(a.currentTarget).text())},okClicked:function(){return console.log(this.$nameInput.val()),this.cb!=null&&this.cb(this.$nameInput.val()),this.$el.modal("hide")},__template:function(){return b.SaveAsDialog},_renderPartial:function(){return c.prototype._renderPartial.call(this),this.$nameInput=this.$el.find("input")},render:function(){return this._renderPartial(),this.$el.modal(),this.$el.modal("hide"),this.$el}})}),define("ui/widgets/BackgroundPicker",["vendor/backbone","./Templates","css!./res/css/BackgroundPicker.css"],function(a,b,c){var d;return d={type:function(a){return this._updatePicker({type:a})},direction:function(a){return this._updatePicker({fillDirection:a})}},a.View.extend({className:"backgroundPicker modal",events:{"click .ok":"okClicked","click [data-option]":"optionChosen"},initialize:function(){},show:function(a,b){return this.$el.modal("show"),b!=null&&this._updatePicker(b),this.cb=a},_updatePicker:function(a){return this.$gradientPicker.gradientPicker("update",a)},_updateGradientPreview:function(a){return this.$gradientPreview.css("background-image",a[0]),this.$gradientPreview.css("background-image",a[1])},okClicked:function(){return this.$el.modal("hide"),this.cb(this.$gradientPicker.gradientPicker("currentState"))},optionChosen:function(a){var b,c;return b=a.currentTarget.dataset.option,c=a.target.dataset.value,d[b].call(this,c)},render:function(){var a,c=this;return this.$el.html(b.BackgroundPicker()),this.$el.modal(),this.$gradientPicker=this.$el.find(".gradientPicker"),this.$gradientPreview=this.$el.find(".gradientPreview"),this.$gradientPicker.css("width",250),a=this.options.bgOpts||{},a.change=function(a,b){return c._updateGradientPreview(b)},this.$gradientPicker.gradientPicker(a),this.$el.modal("hide"),this.$el.find(".dropdown-toggle").dropdown(),this.$el}})}),define("ui/editor/Editor",["vendor/backbone","./SlideEditor","./transition_editor/TransitionEditor","./Templates","ui/impress_renderer/ImpressRenderer","ui/widgets/RawTextImporter","ui/widgets/OpenDialog","ui/widgets/SaveAsDialog","storage/FileStorage","ui/widgets/BackgroundPicker","css!./res/css/Editor.css"],function(a,b,c,d,e,f,g,h,i,j,k){var l,m;return l=0,m={"new":function(a){},open:function(a){var b=this;return this.openDialog.show(function(a){var c;console.log("Attempting to open "+a),c=i.open(a),console.log(c);if(c!=null)return b.model["import"](c)})},openRecent:function(a){},save:function(a){var b;return b=this.model.get("fileName"),b==null?m.saveAs.call(this,a):i.save(b,this.model.toJSON(!1,!0))},saveAs:function(a){var b=this;return this.saveAsDialog.show(function(a){if(a!=null&&a!=="")return console.log("Attempting to save "+a),b.model.set("fileName",a),i.save(a,b.model.toJSON(!1,!0))})},undo:function(a){return this.model.undo()},redo:function(a){return this.model.redo()},cut:function(a){var b;b=this.perspectives[this.activePerspective];if(b!=null)return b.cut()},copy:function(a){var b;b=this.perspectives[this.activePerspective];if(b!=null)return b.copy()},paste:function(a){var b;b=this.perspectives[this.activePerspective];if(b!=null)return b.paste()},transitionEditor:function(a){return this.changePerspective(a,{perspective:"transitionEditor"})},slideEditor:function(a){return this.changePerspective(a,{perspective:"slideEditor"})},preview:function(a){return this.$el.trigger("preview")},exportJSON:function(a){return this.rawTextModal.show(null,JSON.stringify(this.model.toJSON(!1,!0)))},importJSON:function(a){var b=this;return this.rawTextModal.show(function(a){return b.model["import"](JSON.parse(a))})},changeBackground:function(){var a=this;return this.backgroundPickerModal.show(function(b){return a.model.set("background",b)})}},a.View.extend({className:"editor",events:{"click .menuBar .dropdown-menu > li":"menuItemSelected",changePerspective:"changePerspective",preview:"renderPreview"},initialize:function(){return this.id=l++,this.perspectives={slideEditor:new b({model:this.model}),transitionEditor:new c({model:this.model})},this.activePerspective="slideEditor",this.model.undoHistory.on("updated",this.undoHistoryChanged,this),this.model.on("change:background",this._backgroundChanged,this)},undoHistoryChanged:function(){var a,b,c;return c=this.model.undoHistory.undoName(),b=this.model.undoHistory.redoName(),c!==""?(a=this.$el.find(".undoName"),a.text(c),a.removeClass("disp-none")):this.$el.find(".undoName").addClass("disp-none"),b!==""?(a=this.$el.find(".redoName"),a.text(b),a.removeClass("disp-none")):this.$el.find(".redoName").addClass("disp-none")},renderPreview:function(){var a,b;return b=e.render(this.model.attributes),a=window.open("data:text/html;charset=utf-8,"+escape(b))},changePerspective:function(a,b){var c=this;return this.activePerspective=b.perspective,_.each(this.perspectives,function(a,b){return b===c.activePerspective?a.show():a.hide()})},_backgroundChanged:function(a,b){var c,d,e,f;console.log("WTF"),e=this.perspectives,f=[];for(c in e)d=e[c],f.push(d.backgroundChanged(b));return f},menuItemSelected:function(a){var b,c;return b=$(a.currentTarget),c=b.attr("data-option"),m[c].call(this,a)},render:function(){var a,b,c=this;return b=_.map(this.perspectives,function(a,b){return{perspective:b,name:a.name}}),this.$el.html(d.Editor({id:this.id,perspectives:b})),this.$el.find(".dropdown-toggle").dropdown(),a=this.$el.find(".perspectives-container"),_.each(this.perspectives,function(b,d){return a.append(b.render()),d===c.activePerspective?b.show():b.$el.addClass("disp-none")}),this.undoHistoryChanged(),this.rawTextModal=new f,this.$el.append(this.rawTextModal.render()),this.openDialog=new g,this.saveAsDialog=new h,this.$el.append(this.openDialog.render()),this.$el.append(this.saveAsDialog.render()),this.backgroundPickerModal=new j({bgOpts:{type:"radial",controlPoints:["#F0F0F0 0%","#BEBEBE 100%"]}}),this.$el.append(this.backgroundPickerModal.render()),this.$el}})}),define("model/presentation/Slide",["vendor/backbone","model/geom/SpatialObject","./components/ComponentFactory"],function(a,b,c){return b.extend({initialize:function(){var b,d,e=this;return b=this.get("components"),b==null?this.set("components",[]):(d=[],this.set("components",d),b.forEach(function(b){var f;if(b instanceof a.Model)f=b.clone(),d.push(f);else switch(b.type){case"ImageModel":f=c.createImage(b),d.push(f);break;case"TextBox":f=c.createTextBox(b),d.push(f)}return e._registerWithComponent(f)})),this.on("unrender",this._unrendered,this)},_unrendered:function(){return this.get("components").forEach(function(a){return a.trigger("unrender",!0)})},_registerWithComponent:function(a){return a.on("dispose",this.remove,this),a.on("change:selected",this.selectionChanged,this),a.on("change",this.componentChanged,this)},getPositionData:function(){return{x:this.attributes.x,y:this.attributes.y,z:this.attributes.z,impScale:this.attributes.impScale,rotateX:this.attributes.rotateX,rotateY:this.attributes.rotateY,rotateZ:this.attributes.rotateZ}},add:function(a){return this.attributes.components.push(a),this._registerWithComponent(a),this.trigger("contentsChanged"),this.trigger("change:components.add",this,a)},dispose:function(){return this.set({active:!1,selected:!1}),this.trigger("dispose",this),this.off("dispose")},remove:function(a){var b;b=this.attributes.components.indexOf(a);if(b!==-1)return this.attributes.components.splice(b,1),this.trigger("contentsChanged"),this.trigger("change:components.remove",this,a),a.trigger("unrender"),a.off(null,null,this)},componentChanged:function(){return this.trigger("contentsChanged")},unselectComponents:function(){if(this.lastSelection)return this.lastSelection.set("selected",!1)},selectionChanged:function(a,b){return b?(this.lastSelection!==a&&(this.attributes.components.forEach(function(b){if(b!==a)return b.set("selected",!1)}),this.lastSelection=a),this.trigger("change:activeComponent",this,a,b)):(this.trigger("change:activeComponent",this,null),this.lastSelection=null)},constructor:function(){b.prototype.constructor.apply(this,arguments)}})}),define("model/presentation/SlideCollection",["common/Calcium","./Slide"],function(a,b){var c;return c=function(a,b){return a.get("num")-b.get("num")},a.Collection.extend({model:b,initialize:function(){return this.on("add",this._updateNumbers,this),this.on("remove",this._updateNumbers,this)},_updateNumbers:function(){return this.models.forEach(function(a,b){return a.set("num",b)})},sort:function(a){var b,d=this;return a||(a={}),b={},this.models.forEach(function(a,c){var e;e=a.get("num");if(e!==c&&!b[e])return b[e]=!0,b[c]=!0,d._swapTransitionPositions(a,d.models[e])}),this.models.sort(c)},_swapTransitionPositions:function(a,b){var c,d;return d=a.getPositionData(),c={silent:!0},a.set(b.getPositionData(),c),b.set(d,c)}})}),define("common/collections/LinkedList",[],function(){var a;return a=function(){function a(){this.head=this.tail=null,this.length=0}return a.name="LinkedList",a.prototype.push=function(a){var b;return b={prev:null,next:null,value:a},this.tail!=null?(this.tail.next=b,b.prev=this.tail,this.tail=b):this.head=this.tail=b,++this.length,this},a.prototype.pop=function(){var a;if(this.tail==null)throw"List is empty";return a=this.tail.value,this.tail===this.head?this.tail=this.head=null:(this.tail=this.tail.prev,this.tail.next=null),--this.length,a},a.prototype.shift=function(){var a;if(this.head==null)throw"List is empty";return a=this.head.value,this.tail===this.head?this.tail=this.head=null:(this.head=this.head.next,this.head.prev=null),--this.length,a},a.prototype.unshift=function(a){var b;return b={prev:null,next:null,value:a},this.head!=null?(this.head.prev=b,b.next=this.head,this.head=b):this.head=this.tail=b,++this.length,this},a.prototype.first=function(){return this.head.value},a.prototype.last=function(){return this.tail.value},a.prototype.forEach=function(a){var b,c,d;b=this.head,c=0,d=[];while(b!==null)a(b.value,c++,this),d.push(b=b.next);return d},a}()}),define("model/common_application/UndoHistory",["common/EventEmitter","common/collections/LinkedList"],function(a,b){var c;return c=function(){function c(c){this.size=c,this.actions=new b,this.cursor=null,this.undoCount=0,_.extend(this,new a)}return c.name="UndoHistory",c.prototype.push=function(a){var b;return this.actions.length-this.undoCount<this.size?this.undoCount>0?(b={prev:null,next:null,value:a},this.cursor?(b.prev=this.cursor,this.cursor.next.prev=null,this.cursor.next=b,this.actions.length+=1,this.actions.length=this.actions.length-this.undoCount):(this.actions.head=b,this.actions.tail=b,this.actions.length=1),this.undoCount=0,this.cursor=null):this.actions.push(a):(this.actions.shift(),this.actions.push(a)),this.emit("updated"),this},c.prototype.undoName=function(){var a;return this.undoCount<this.actions.length?(a=this.cursor||this.actions.tail,a!=null?a.value.name:""):""},c.prototype.redoName=function(){var a;return this.undoCount>0?(this.cursor==null?a=this.actions.head:a=this.cursor.next,a!=null?a.value.name:""):""},c.prototype.undo=function(){return this.undoCount<this.actions.length&&(this.cursor==null&&(this.cursor=this.actions.tail),this.cursor.value.undo(),this.cursor=this.cursor.prev,++this.undoCount,this.emit("updated")),this},c.prototype.redo=function(){return this.undoCount>0&&(this.cursor==null?this.cursor=this.actions.head:this.cursor=this.cursor.next,this.cursor.value["do"](),--this.undoCount,this.emit("updated")),this},c}()}),define("model/presentation/Deck",["common/Calcium","./SlideCollection","./Slide","model/common_application/UndoHistory"],function(a,b,c,d){var e,f;return e=function(a){return this.deck=a,this},e.prototype={"do":function(){var a;return a=this.deck.get("slides"),this.slide==null&&(this.slide=new c({num:a.length})),a.add(this.slide),this.slide},undo:function(){return this.deck.get("slides").remove(this.slide),this.slide},name:"Create Slide"},f=function(a,b){return this.deck=a,this.slide=b,this},f.prototype={"do":function(){var a;return a=this.deck.get("slides"),a.remove(this.slide),this.slide},undo:function(){return this.deck.get("slides").add(this.slide)},name:"Remove Slide"},a.Model.extend({initialize:function(){var a;return this.undoHistory=new d(20),this.set("slides",new b),a=this.get("slides"),a.on("add",this._slideAdded,this),a.on("remove",this._slideRemoved,this),a.on("reset",this._slidesReset,this),this._lastSelected=null},newSlide:function(){var a,b;return a=new e(this),b=a["do"](),this.undoHistory.push(a),b},set:function(b,c){return b==="activeSlide"&&this._activeSlideChanging(c),a.Model.prototype.set.apply(this,arguments)},"import":function(a){var b,c;return c=this.get("slides"),b=this.get("activeSlide"),b!=null&&b.unselectComponents(),this.set("activeSlide",null),this.set("background",a.background),c.reset(a.slides)},_activeSlideChanging:function(a){var b;b=this.get("activeSlide");if(a===b)return null;b!=null&&(b.unselectComponents(),b.set({active:!1,selected:!1}));if(a!=null)return a.set({selected:!0,active:!0})},_slideAdded:function(a,b){return this.set("activeSlide",a),this._registerWithSlide(a)},_slideDisposed:function(a){return a.off(null,null,this)},_slideRemoved:function(a,b,c){return console.log("Slide removed"),this.get("activeSlide")===a&&(c.index<b.length?this.set("activeSlide",b.at(c.index)):c.index>0?this.set("activeSlide",b.at(c.index-1)):this.set("activeSlide",null)),a.dispose()},_slidesReset:function(a,b,c){var d=this;return c.forEach(function(a){return a.dispose()}),a.forEach(function(a){d._registerWithSlide(a);if(a.get("active"))return a.trigger("change:active",a,!0);if(a.get("selected"))return a.set("selected",!1)})},_slideActivated:function(a,b){if(b)return this.set("activeSlide",a)},_slideSelected:function(a,b){return this._lastSelected!=null&&b&&this._lastSelected!==a&&this._lastSelected.set("selected",!1),this._lastSelected=a},_registerWithSlide:function(a){return a.on("change:active",this._slideActivated,this),a.on("change:selected",this._slideSelected,this),a.on("dispose",this._slideDisposed,this)},removeSlide:function(a){var b;return b=new f(this,a),a=b["do"](),this.undoHistory.push(b),a},addSlide:function(a){return this.get("slides").add(a)},undo:function(){return this.undoHistory.undo()},redo:function(){return this.undoHistory.redo()}})});var continuation;requirejs.config({paths:{css:"vendor/amd_plugins/css",text:"vendor/amd_plugins/text"}}),window.browserPrefix="",$.browser.mozilla?window.browserPrefix="-moz-":$.browser.msie?window.browserPrefix="-ms-":$.browser.opera?window.browserPrefix="-o-":$.browser.webkit&&(window.browserPrefix="-webkit-"),window.localStorage==null&&(window.localStorage={setItem:function(){},getItem:function(){},length:0}),requirejs(["vendor/backbone","state/DefaultState"],function(a,b){return a.sync=function(a,c,d){if(d.keyTrail!=null)return d.success(b.get(d.keyTrail))},window.slideConfig={size:{width:1024,height:768}},continuation()}),continuation=function(){return requirejs(["ui/editor/Editor","model/presentation/Deck"],function(a,b){var c,d;return c=new b,d=new a({model:c}),window.zTracker={z:0,next:function(){return++this.z}},$("body").append(d.render()),c.newSlide()})},define("main",function(){})